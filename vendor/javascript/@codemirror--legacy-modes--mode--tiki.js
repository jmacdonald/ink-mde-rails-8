// @codemirror/legacy-modes/mode/tiki@6.4.2 downloaded from https://ga.jspm.io/npm:@codemirror/legacy-modes@6.4.2/mode/tiki.js

function inBlock(n,t,e){return function(i,r){while(!i.eol()){if(i.match(t)){r.tokenize=inText;break}i.next()}e&&(r.tokenize=e);return n}}function inLine(n){return function(t,e){while(!t.eol())t.next();e.tokenize=inText;return n}}function inText(n,t){function chain(e){t.tokenize=e;return e(n,t)}var e=n.sol();var i=n.next();switch(i){case"{":n.eat("/");n.eatSpace();n.eatWhile(/[^\s\u00a0=\"\'\/?(}]/);t.tokenize=inPlugin;return"tag";case"_":if(n.eat("_"))return chain(inBlock("strong","__",inText));break;case"'":if(n.eat("'"))return chain(inBlock("em","''",inText));break;case"(":if(n.eat("("))return chain(inBlock("link","))",inText));break;case"[":return chain(inBlock("url","]",inText));case"|":if(n.eat("|"))return chain(inBlock("comment","||"));break;case"-":if(n.eat("="))return chain(inBlock("header string","=-",inText));if(n.eat("-"))return chain(inBlock("error tw-deleted","--",inText));break;case"=":if(n.match("=="))return chain(inBlock("tw-underline","===",inText));break;case":":if(n.eat(":"))return chain(inBlock("comment","::"));break;case"^":return chain(inBlock("tw-box","^"));case"~":if(n.match("np~"))return chain(inBlock("meta","~/np~"));break}if(e)switch(i){case"!":return n.match("!!!!!")||n.match("!!!!")||n.match("!!!")||n.match("!!"),chain(inLine("header string"));case"*":case"#":case"+":return chain(inLine("tw-listitem bracket"))}return null}var n,t;function inPlugin(n,e){var i=n.next();var r=n.peek();if(i=="}"){e.tokenize=inText;return"tag"}if(i=="("||i==")")return"bracket";if(i=="="){t="equals";if(r==">"){n.next();r=n.peek()}/[\'\"]/.test(r)||(e.tokenize=inAttributeNoQuote());return"operator"}if(/[\'\"]/.test(i)){e.tokenize=inAttribute(i);return e.tokenize(n,e)}n.eatWhile(/[^\s\u00a0=\"\'\/?]/);return"keyword"}function inAttribute(n){return function(t,e){while(!t.eol())if(t.next()==n){e.tokenize=inPlugin;break}return"string"}}function inAttributeNoQuote(){return function(n,t){while(!n.eol()){var e=n.next();var i=n.peek();if(e==" "||e==","||/[ )}]/.test(i)){t.tokenize=inPlugin;break}}return"string"}}var e,i;function pass(){for(var n=arguments.length-1;n>=0;n--)e.cc.push(arguments[n])}function cont(){pass.apply(null,arguments);return true}function pushContext(n,t){var i=e.context&&e.context.noIndent;e.context={prev:e.context,pluginName:n,indent:e.indented,startOfLine:t,noIndent:i}}function popContext(){e.context&&(e.context=e.context.prev)}function element(t){if(t=="openPlugin"){e.pluginName=n;return cont(attributes,endplugin(e.startOfLine))}if(t=="closePlugin"){var r=false;if(e.context){r=e.context.pluginName!=n;popContext()}else r=true;r&&(i="error");return cont(endcloseplugin(r))}if(t=="string"){e.context&&e.context.name=="!cdata"||pushContext("!cdata");e.tokenize==inText&&popContext();return cont()}return cont()}function endplugin(n){return function(t){if(t=="selfclosePlugin"||t=="endPlugin")return cont();if(t=="endPlugin"){pushContext(e.pluginName,n);return cont()}return cont()}}function endcloseplugin(n){return function(t){n&&(i="error");return t=="endPlugin"?cont():pass()}}function attributes(n){if(n=="keyword"){i="attribute";return cont(attributes)}return n=="equals"?cont(attvalue,attributes):pass()}function attvalue(n){if(n=="keyword"){i="string";return cont()}return n=="string"?cont(attvaluemaybe):pass()}function attvaluemaybe(n){return n=="string"?cont(attvaluemaybe):pass()}const r={name:"tiki",startState:function(){return{tokenize:inText,cc:[],indented:0,startOfLine:true,pluginName:null,context:null}},token:function(r,a){if(r.sol()){a.startOfLine=true;a.indented=r.indentation()}if(r.eatSpace())return null;i=t=n=null;var u=a.tokenize(r,a);if((u||t)&&u!="comment"){e=a;while(true){var o=a.cc.pop()||element;if(o(t||u))break}}a.startOfLine=false;return i||u},indent:function(n,t,e){var i=n.context;if(i&&i.noIndent)return 0;i&&/^{\//.test(t)&&(i=i.prev);while(i&&!i.startOfLine)i=i.prev;return i?i.indent+e.unit:0}};export{r as tiki};

