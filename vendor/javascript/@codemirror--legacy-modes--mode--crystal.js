// @codemirror/legacy-modes/mode/crystal@6.4.2 downloaded from https://ga.jspm.io/npm:@codemirror/legacy-modes@6.4.2/mode/crystal.js

function wordRegExp(e,t){return new RegExp((t?"":"^")+"(?:"+e.join("|")+")"+(t?"$":"\\b"))}function chain(e,t,n){n.tokenize.push(e);return e(t,n)}var e=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/;var t=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/;var n=/^(?:\[\][?=]?)/;var r=/^(?:\.(?:\.{2})?|->|[?:])/;var a=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var o=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/;var u=wordRegExp(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","select","sizeof","struct","super","then","type","typeof","uninitialized","union","unless","until","when","while","with","yield","__DIR__","__END_LINE__","__FILE__","__LINE__"]);var i=wordRegExp(["true","false","nil","self"]);var c=["def","fun","macro","class","module","struct","lib","enum","union","do","for"];var s=wordRegExp(c);var f=["if","unless","case","while","until","begin","then"];var l=wordRegExp(f);var k=["end","else","elsif","rescue","ensure"];var h=wordRegExp(k);var m=["\\)","\\}","\\]"];var p=new RegExp("^(?:"+m.join("|")+")$");var d={def:tokenFollowIdent,fun:tokenFollowIdent,macro:tokenMacroDef,class:tokenFollowType,module:tokenFollowType,struct:tokenFollowType,lib:tokenFollowType,enum:tokenFollowType,union:tokenFollowType};var F={"[":"]","{":"}","(":")","<":">"};function tokenBase(c,f){if(c.eatSpace())return null;if(f.lastToken!="\\"&&c.match("{%",false))return chain(tokenMacro("%","%"),c,f);if(f.lastToken!="\\"&&c.match("{{",false))return chain(tokenMacro("{","}"),c,f);if(c.peek()=="#"){c.skipToEnd();return"comment"}var k;if(c.match(a)){c.eat(/[?!]/);k=c.current();if(c.eat(":"))return"atom";if(f.lastToken==".")return"property";if(u.test(k)){if(s.test(k)){if(!(k=="fun"&&f.blocks.indexOf("lib")>=0)&&!(k=="def"&&f.lastToken=="abstract")){f.blocks.push(k);f.currentIndent+=1}}else if(f.lastStyle!="operator"&&f.lastStyle||!l.test(k)){if(k=="end"){f.blocks.pop();f.currentIndent-=1}}else{f.blocks.push(k);f.currentIndent+=1}d.hasOwnProperty(k)&&f.tokenize.push(d[k]);return"keyword"}return i.test(k)?"atom":"variable"}if(c.eat("@")){if(c.peek()=="[")return chain(tokenNest("[","]","meta"),c,f);c.eat("@");c.match(a)||c.match(o);return"propertyName"}if(c.match(o))return"tag";if(c.eat(":")){if(c.eat('"'))return chain(tokenQuote('"',"atom",false),c,f);if(c.match(a)||c.match(o)||c.match(e)||c.match(t)||c.match(n))return"atom";c.eat(":");return"operator"}if(c.eat('"'))return chain(tokenQuote('"',"string",true),c,f);if(c.peek()=="%"){var h="string";var m=true;var p;if(c.match("%r")){h="string.special";p=c.next()}else if(c.match("%w")){m=false;p=c.next()}else if(c.match("%q")){m=false;p=c.next()}else if(p=c.match(/^%([^\w\s=])/))p=p[1];else{if(c.match(/^%[a-zA-Z_\u009F-\uFFFF][\w\u009F-\uFFFF]*/))return"meta";if(c.eat("%"))return"operator"}F.hasOwnProperty(p)&&(p=F[p]);return chain(tokenQuote(p,h,m),c,f)}if(k=c.match(/^<<-('?)([A-Z]\w*)\1/))return chain(tokenHereDoc(k[2],!k[1]),c,f);if(c.eat("'")){c.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/);c.eat("'");return"atom"}if(c.eat("0")){c.eat("x")?c.match(/^[0-9a-fA-F_]+/):c.eat("o")?c.match(/^[0-7_]+/):c.eat("b")&&c.match(/^[01_]+/);return"number"}if(c.eat(/^\d/)){c.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+-]?\d+)?/);return"number"}if(c.match(e)){c.eat("=");return"operator"}if(c.match(t)||c.match(r))return"operator";if(k=c.match(/[({[]/,false)){k=k[0];return chain(tokenNest(k,F[k],null),c,f)}if(c.eat("\\")){c.next();return"meta"}c.next();return null}function tokenNest(e,t,n,r){return function(a,o){if(!r&&a.match(e)){o.tokenize[o.tokenize.length-1]=tokenNest(e,t,n,true);o.currentIndent+=1;return n}var u=tokenBase(a,o);if(a.current()===t){o.tokenize.pop();o.currentIndent-=1;u=n}return u}}function tokenMacro(e,t,n){return function(r,a){if(!n&&r.match("{"+e)){a.currentIndent+=1;a.tokenize[a.tokenize.length-1]=tokenMacro(e,t,true);return"meta"}if(r.match(t+"}")){a.currentIndent-=1;a.tokenize.pop();return"meta"}return tokenBase(r,a)}}function tokenMacroDef(e,t){if(e.eatSpace())return null;var n;if(n=e.match(a)){if(n=="def")return"keyword";e.eat(/[?!]/)}t.tokenize.pop();return"def"}function tokenFollowIdent(r,o){if(r.eatSpace())return null;r.match(a)?r.eat(/[!?]/):r.match(e)||r.match(t)||r.match(n);o.tokenize.pop();return"def"}function tokenFollowType(e,t){if(e.eatSpace())return null;e.match(o);t.tokenize.pop();return"def"}function tokenQuote(e,t,n){return function(r,a){var o=false;while(r.peek())if(o){r.next();o=false}else{if(r.match("{%",false)){a.tokenize.push(tokenMacro("%","%"));return t}if(r.match("{{",false)){a.tokenize.push(tokenMacro("{","}"));return t}if(n&&r.match("#{",false)){a.tokenize.push(tokenNest("#{","}","meta"));return t}var u=r.next();if(u==e){a.tokenize.pop();return t}o=n&&u=="\\"}return t}}function tokenHereDoc(e,t){return function(n,r){if(n.sol()){n.eatSpace();if(n.match(e)){r.tokenize.pop();return"string"}}var a=false;while(n.peek())if(a){n.next();a=false}else{if(n.match("{%",false)){r.tokenize.push(tokenMacro("%","%"));return"string"}if(n.match("{{",false)){r.tokenize.push(tokenMacro("{","}"));return"string"}if(t&&n.match("#{",false)){r.tokenize.push(tokenNest("#{","}","meta"));return"string"}a=n.next()=="\\"&&t}return"string"}}const w={name:"crystal",startState:function(){return{tokenize:[tokenBase],currentIndent:0,lastToken:null,lastStyle:null,blocks:[]}},token:function(e,t){var n=t.tokenize[t.tokenize.length-1](e,t);var r=e.current();if(n&&n!="comment"){t.lastToken=r;t.lastStyle=n}return n},indent:function(e,t,n){t=t.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,"");return h.test(t)||p.test(t)?n.unit*(e.currentIndent-1):n.unit*e.currentIndent},languageData:{indentOnInput:wordRegExp(m.concat(k),true),commentTokens:{line:"#"}}};export{w as crystal};

