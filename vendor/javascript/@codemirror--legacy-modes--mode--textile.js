// @codemirror/legacy-modes/mode/textile@6.4.2 downloaded from https://ga.jspm.io/npm:@codemirror/legacy-modes@6.4.2/mode/textile.js

var e={addition:"inserted",attributes:"propertyName",bold:"strong",cite:"keyword",code:"monospace",definitionList:"list",deletion:"deleted",div:"punctuation",em:"emphasis",footnote:"variable",footCite:"qualifier",header:"heading",html:"comment",image:"atom",italic:"emphasis",link:"link",linkDefinition:"link",list1:"list",list2:"list.special",list3:"list",notextile:"string.special",pre:"operator",p:"content",quote:"bracket",span:"quote",specialChar:"character",strong:"strong",sub:"content.special",sup:"content.special",table:"variableName.special",tableHeading:"operator"};function startNewLine(e,t){t.mode=i.newLayout;t.tableHeading=false;t.layoutType==="definitionList"&&t.spanningLayout&&e.match(RE("definitionListEnd"),false)&&(t.spanningLayout=false)}function handlePhraseModifier(t,i,n){if(n==="_")return t.eat("_")?togglePhraseModifier(t,i,"italic",/__/,2):togglePhraseModifier(t,i,"em",/_/,1);if(n==="*")return t.eat("*")?togglePhraseModifier(t,i,"bold",/\*\*/,2):togglePhraseModifier(t,i,"strong",/\*/,1);if(n==="["){t.match(/\d+\]/)&&(i.footCite=true);return tokenStyles(i)}if(n==="("){var a=t.match(/^(r|tm|c)\)/);if(a)return e.specialChar}if(n==="<"&&t.match(/(\w+)[^>]+>[^<]+<\/\1>/))return e.html;if(n==="?"&&t.eat("?"))return togglePhraseModifier(t,i,"cite",/\?\?/,2);if(n==="="&&t.eat("="))return togglePhraseModifier(t,i,"notextile",/==/,2);if(n==="-"&&!t.eat("-"))return togglePhraseModifier(t,i,"deletion",/-/,1);if(n==="+")return togglePhraseModifier(t,i,"addition",/\+/,1);if(n==="~")return togglePhraseModifier(t,i,"sub",/~/,1);if(n==="^")return togglePhraseModifier(t,i,"sup",/\^/,1);if(n==="%")return togglePhraseModifier(t,i,"span",/%/,1);if(n==="@")return togglePhraseModifier(t,i,"code",/@/,1);if(n==="!"){var r=togglePhraseModifier(t,i,"image",/(?:\([^\)]+\))?!/,1);t.match(/^:\S+/);return r}return tokenStyles(i)}function togglePhraseModifier(e,t,n,a,r){var l=e.pos>r?e.string.charAt(e.pos-r-1):null;var o=e.peek();if(t[n]){if((!o||/\W/.test(o))&&l&&/\S/.test(l)){var s=tokenStyles(t);t[n]=false;return s}}else if((!l||/\W/.test(l))&&o&&/\S/.test(o)&&e.match(new RegExp("^.*\\S"+a.source+"(?:\\W|$)"),false)){t[n]=true;t.mode=i.attributes}return tokenStyles(t)}function tokenStyles(t){var i=textileDisabled(t);if(i)return i;var n=[];t.layoutType&&n.push(e[t.layoutType]);n=n.concat(activeStyles(t,"addition","bold","cite","code","deletion","em","footCite","image","italic","link","span","strong","sub","sup","table","tableHeading"));t.layoutType==="header"&&n.push(e.header+"-"+t.header);return n.length?n.join(" "):null}function textileDisabled(t){var i=t.layoutType;switch(i){case"notextile":case"code":case"pre":return e[i];default:return t.notextile?e.notextile+(i?" "+e[i]:""):null}}function activeStyles(t){var i=[];for(var n=1;n<arguments.length;++n)t[arguments[n]]&&i.push(e[arguments[n]]);return i}function blankLine(e){var t=e.spanningLayout,n=e.layoutType;for(var a in e)e.hasOwnProperty(a)&&delete e[a];e.mode=i.newLayout;if(t){e.layoutType=n;e.spanningLayout=true}}var t={cache:{},single:{bc:"bc",bq:"bq",definitionList:/- .*?:=+/,definitionListEnd:/.*=:\s*$/,div:"div",drawTable:/\|.*\|/,foot:/fn\d+/,header:/h[1-6]/,html:/\s*<(?:\/)?(\w+)(?:[^>]+)?>(?:[^<]+<\/\1>)?/,link:/[^"]+":\S/,linkDefinition:/\[[^\s\]]+\]\S+/,list:/(?:#+|\*+)/,notextile:"notextile",para:"p",pre:"pre",table:"table",tableCellAttributes:/[\/\\]\d+/,tableHeading:/\|_\./,tableText:/[^"_\*\[\(\?\+~\^%@|-]+/,text:/[^!"_=\*\[\(<\?\+~\^%@-]+/},attributes:{align:/(?:<>|<|>|=)/,selector:/\([^\(][^\)]+\)/,lang:/\[[^\[\]]+\]/,pad:/(?:\(+|\)+){1,2}/,css:/\{[^\}]+\}/},createRe:function(e){switch(e){case"drawTable":return t.makeRe("^",t.single.drawTable,"$");case"html":return t.makeRe("^",t.single.html,"(?:",t.single.html,")*","$");case"linkDefinition":return t.makeRe("^",t.single.linkDefinition,"$");case"listLayout":return t.makeRe("^",t.single.list,RE("allAttributes"),"*\\s+");case"tableCellAttributes":return t.makeRe("^",t.choiceRe(t.single.tableCellAttributes,RE("allAttributes")),"+\\.");case"type":return t.makeRe("^",RE("allTypes"));case"typeLayout":return t.makeRe("^",RE("allTypes"),RE("allAttributes"),"*\\.\\.?","(\\s+|$)");case"attributes":return t.makeRe("^",RE("allAttributes"),"+");case"allTypes":return t.choiceRe(t.single.div,t.single.foot,t.single.header,t.single.bc,t.single.bq,t.single.notextile,t.single.pre,t.single.table,t.single.para);case"allAttributes":return t.choiceRe(t.attributes.selector,t.attributes.css,t.attributes.lang,t.attributes.align,t.attributes.pad);default:return t.makeRe("^",t.single[e])}},makeRe:function(){var e="";for(var t=0;t<arguments.length;++t){var i=arguments[t];e+=typeof i==="string"?i:i.source}return new RegExp(e)},choiceRe:function(){var e=[arguments[0]];for(var i=1;i<arguments.length;++i){e[i*2-1]="|";e[i*2]=arguments[i]}e.unshift("(?:");e.push(")");return t.makeRe.apply(null,e)}};function RE(e){return t.cache[e]||(t.cache[e]=t.createRe(e))}var i={newLayout:function(e,t){if(e.match(RE("typeLayout"),false)){t.spanningLayout=false;return(t.mode=i.blockType)(e,t)}var n;textileDisabled(t)||(e.match(RE("listLayout"),false)?n=i.list:e.match(RE("drawTable"),false)?n=i.table:e.match(RE("linkDefinition"),false)?n=i.linkDefinition:e.match(RE("definitionList"))?n=i.definitionList:e.match(RE("html"),false)&&(n=i.html));return(t.mode=n||i.text)(e,t)},blockType:function(e,t){var n,a;t.layoutType=null;if(!(n=e.match(RE("type"))))return(t.mode=i.text)(e,t);a=n[0];if(n=a.match(RE("header"))){t.layoutType="header";t.header=parseInt(n[0][1])}else a.match(RE("bq"))?t.layoutType="quote":a.match(RE("bc"))?t.layoutType="code":a.match(RE("foot"))?t.layoutType="footnote":a.match(RE("notextile"))?t.layoutType="notextile":a.match(RE("pre"))?t.layoutType="pre":a.match(RE("div"))?t.layoutType="div":a.match(RE("table"))&&(t.layoutType="table");t.mode=i.attributes;return tokenStyles(t)},text:function(e,t){if(e.match(RE("text")))return tokenStyles(t);var n=e.next();return n==='"'?(t.mode=i.link)(e,t):handlePhraseModifier(e,t,n)},attributes:function(t,n){n.mode=i.layoutLength;return t.match(RE("attributes"))?e.attributes:tokenStyles(n)},layoutLength:function(e,t){e.eat(".")&&e.eat(".")&&(t.spanningLayout=true);t.mode=i.text;return tokenStyles(t)},list:function(e,t){var n=e.match(RE("list"));t.listDepth=n[0].length;var a=(t.listDepth-1)%3;t.layoutType=a?a===1?"list2":"list3":"list1";t.mode=i.attributes;return tokenStyles(t)},link:function(t,n){n.mode=i.text;if(t.match(RE("link"))){t.match(/\S+/);return e.link}return tokenStyles(n)},linkDefinition:function(t){t.skipToEnd();return e.linkDefinition},definitionList:function(e,t){e.match(RE("definitionList"));t.layoutType="definitionList";e.match(/\s*$/)?t.spanningLayout=true:t.mode=i.attributes;return tokenStyles(t)},html:function(t){t.skipToEnd();return e.html},table:function(e,t){t.layoutType="table";return(t.mode=i.tableCell)(e,t)},tableCell:function(e,t){e.match(RE("tableHeading"))?t.tableHeading=true:e.eat("|");t.mode=i.tableCellAttributes;return tokenStyles(t)},tableCellAttributes:function(t,n){n.mode=i.tableText;return t.match(RE("tableCellAttributes"))?e.attributes:tokenStyles(n)},tableText:function(e,t){if(e.match(RE("tableText")))return tokenStyles(t);if(e.peek()==="|"){t.mode=i.tableCell;return tokenStyles(t)}return handlePhraseModifier(e,t,e.next())}};const n={name:"textile",startState:function(){return{mode:i.newLayout}},token:function(e,t){e.sol()&&startNewLine(e,t);return t.mode(e,t)},blankLine:blankLine};export{n as textile};

