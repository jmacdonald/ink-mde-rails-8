// @replit/codemirror-vim@6.2.1 downloaded from https://ga.jspm.io/npm:@replit/codemirror-vim@6.2.1/dist/index.js

import{EditorSelection as e,MapMode as t,Prec as r,RangeSetBuilder as n,StateEffect as o,StateField as i}from"@codemirror/state";import{foldCode as a,matchBrackets as s,indentUnit as l,ensureSyntaxTree as c,StringStream as u}from"@codemirror/language";import*as h from"@codemirror/view";import{runScopeHandlers as f,EditorView as d,Direction as p,Decoration as m,ViewPlugin as v,showPanel as g}from"@codemirror/view";import{SearchQuery as y,setSearchQuery as C,RegExpCursor as w}from"@codemirror/search";import{undo as S,redo as k,indentMore as x,indentLess as M,cursorLineBoundaryBackward as L,cursorLineBoundaryForward as b,cursorCharBackward as A,cursorCharLeft as E,insertNewlineAndIndent as T,indentSelection as O}from"@codemirror/commands";
/**
 * @typedef { import("./cm_adapter").CodeMirror } CodeMirror
 * @typedef { import("./types").CodeMirrorV} CodeMirrorV
 * @typedef { import("./types").Pos } Pos
 * @typedef { import("./types").CM5Range } CM5Range
 * @typedef { import("./types").vimState } vimState 
 * @typedef { import("./types").ExFn } ExFn
 * @typedef { import("./types").MotionArgs } MotionArgs
 * @typedef { import("./types").ActionArgs } ActionArgs
 * @typedef { import("./types").OperatorArgs } OperatorArgs
 * @typedef { import("./types").vimKey } vimKey
 * @typedef { import("./types").InputStateInterface } InputStateInterface
 */
function initVim(e){var t=e.Pos;function updateSelectionForSurrogateCharacters(e,t,r){if(t.line===r.line&&t.ch>=r.ch-1){var n=e.getLine(t.line);var o=n.charCodeAt(t.ch);55296<=o&&o<=55551&&(r.ch+=1)}return{start:t,end:r}}
/** @type {import("./types").vimKeyMap} */var r=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"g<Up>",type:"keyToKey",toKeys:"gk"},{keys:"g<Down>",type:"keyToKey",toKeys:"gj"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h"},{keys:"<Del>",type:"keyToKey",toKeys:"x"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-Esc>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"keyToKey",toKeys:"i",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:true,toJumplist:true}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:false}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:true}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:true,linewise:true}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:false,linewise:true}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:true}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:false}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:false,bigWord:true}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,inclusive:true}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:true,wordEnd:true,bigWord:true,inclusive:true}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false,bigWord:true}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,inclusive:true}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:false,wordEnd:true,bigWord:true,inclusive:true}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:false,toJumplist:true}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:true,toJumplist:true}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:false}},{keys:")",type:"motion",motion:"moveBySentence",motionArgs:{forward:true}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:true}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:false}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:true,explicitRepeat:true}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:false,explicitRepeat:true}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:true,explicitRepeat:true,linewise:true,toJumplist:true}},{keys:"g$",type:"motion",motion:"moveToEndOfDisplayLine"},{keys:"g^",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"g0",type:"motion",motion:"moveToStartOfDisplayLine"},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:false,toFirstChar:true}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:true,toFirstChar:true,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:true}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:true,toJumplist:true}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:false}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:true,inclusive:true}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:false}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:true}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:false}},{keys:"'<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true,linewise:true}},{keys:"`<register>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:true}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:true}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:false}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:true,linewise:true}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:false,linewise:true}},{keys:"]p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true,matchIndent:true}},{keys:"[p",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true,matchIndent:true}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:true,toJumplist:true}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:false,toJumplist:true}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:true},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:true}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:false}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},isEdit:true},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},isEdit:true},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:true}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:false,toJumplist:true}},{keys:"gn",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:true}},{keys:"gN",type:"motion",motion:"findAndSelectNextInclusive",motionArgs:{forward:false}},{keys:"gq",type:"operator",operator:"hardWrap"},{keys:"gw",type:"operator",operator:"hardWrap",operatorArgs:{keepCursor:true}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:true},operatorMotionArgs:{visualLine:false}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:false},operatorMotionArgs:{visualLine:true}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:true},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:true},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:true},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:true},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:true},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:true},operatorArgs:{shouldMoveCursor:true},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-u>",type:"operatorMotion",operator:"delete",motion:"moveToStartOfLine",context:"insert"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:false,wordEnd:false},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:true}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:false}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:true,linewise:true}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:false,linewise:true}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"lastEdit"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:true},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:true,interlaceInsertRepeat:true,actionArgs:{after:false},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:true}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:true}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:true},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:true},isEdit:true},{keys:"p",type:"action",action:"paste",isEdit:true,actionArgs:{after:true,isEdit:true}},{keys:"P",type:"action",action:"paste",isEdit:true,actionArgs:{after:false,isEdit:true}},{keys:"r<character>",type:"action",action:"replace",isEdit:true},{keys:"@<register>",type:"action",action:"replayMacro"},{keys:"q<register>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:true,actionArgs:{replace:true},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:true,fullLine:true},context:"visual",exitVisualBlock:true},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:true},context:"visual",isEdit:true},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:false},context:"visual",isEdit:true},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<register>",type:"action",action:"setMark"},{keys:'"<register>',type:"action",action:"setRegister"},{keys:"<C-r><register>",type:"action",action:"insertRegister",context:"insert",isEdit:true},{keys:"<C-o>",type:"action",action:"oneNormalCommand",context:"insert"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:true,backtrack:false}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:true,actionArgs:{increase:false,backtrack:false}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:true},context:"insert"},{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:false},context:"insert"},{keys:"a<register>",type:"motion",motion:"textObjectManipulation"},{keys:"i<register>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:true}},{keys:"/",type:"search",searchArgs:{forward:true,querySrc:"prompt",toJumplist:true}},{keys:"?",type:"search",searchArgs:{forward:false,querySrc:"prompt",toJumplist:true}},{keys:"*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",wholeWordOnly:true,toJumplist:true}},{keys:"g*",type:"search",searchArgs:{forward:true,querySrc:"wordUnderCursor",toJumplist:true}},{keys:"g#",type:"search",searchArgs:{forward:false,querySrc:"wordUnderCursor",toJumplist:true}},{keys:":",type:"ex"}];var n=r.length;var o=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"omap",shortName:"om"},{name:"noremap",shortName:"no"},{name:"nnoremap",shortName:"nn"},{name:"vnoremap",shortName:"vn"},{name:"inoremap",shortName:"ino"},{name:"onoremap",shortName:"ono"},{name:"unmap"},{name:"mapclear",shortName:"mapc"},{name:"nmapclear",shortName:"nmapc"},{name:"vmapclear",shortName:"vmapc"},{name:"imapclear",shortName:"imapc"},{name:"omapclear",shortName:"omapc"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:true},{name:"startinsert",shortName:"start"},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:true},{name:"vglobal",shortName:"v"},{name:"delete",shortName:"d"},{name:"join",shortName:"j"},{name:"normal",shortName:"norm"},{name:"global",shortName:"g"}];var i=parseLangmap("");function enterVimMode(t){t.setOption("disableInput",true);t.setOption("showCursorWhenSelecting",false);e.signal(t,"vim-mode-change",{mode:"normal"});t.on("cursorActivity",onCursorActivity);maybeInitVimState(t);e.on(t.getInputField(),"paste",getOnPasteFn(t))}function leaveVimMode(t){t.setOption("disableInput",false);t.off("cursorActivity",onCursorActivity);e.off(t.getInputField(),"paste",getOnPasteFn(t));t.state.vim=null;I&&clearTimeout(I)}function getOnPasteFn(e){var t=e.state.vim;t.onPasteFn||(t.onPasteFn=function(){if(!t.insertMode){e.setCursor(offsetCursor(e.getCursor(),0,1));b.enterInsertMode(e,{},t)}});return t.onPasteFn}var a=/[\d]/;var s=[e.isWordChar,function(t){return t&&!e.isWordChar(t)&&!/\s/.test(t)}],l=[function(e){return/\S/.test(e)}];var c=["<",">"];var u=["-",'"',".",":","_","/","+"];var h=/^\w$/;var f;try{f=new RegExp("^[\\p{Lu}]$","u")}catch(e){f=/^[A-Z]$/}function isLine(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function isLowerCase(e){return/^[a-z]$/.test(e)}function isMatchableSymbol(e){return"()[]{}".indexOf(e)!=-1}function isNumber(e){return a.test(e)}function isUpperCase(e){return f.test(e)}function isWhiteSpaceString(e){return/^\s*$/.test(e)}function isEndOfSentenceSymbol(e){return".?!".indexOf(e)!=-1}function inArray(e,t){for(var r=0;r<t.length;r++)if(t[r]==e)return true;return false}
/** @typedef {import("./types").optionCallback} optionCallback */
/** @typedef {import("./types").vimOption} vimOption */
/** @type {Object<string, vimOption>} */var d={};function defineOption(e,t,r,n,o){if(t===void 0&&!o)throw Error("defaultValue is required unless callback is provided");r||(r="string");d[e]={type:r,defaultValue:t,callback:o};if(n)for(var i=0;i<n.length;i++)d[n[i]]=d[e];t&&setOption(e,t)}function setOption(e,t,r,n){var o=d[e];n=n||{};var i=n.scope;if(!o)return new Error("Unknown option: "+e);if(o.type=="boolean"){if(t&&t!==true)return new Error("Invalid argument: "+e+"="+t);t!==false&&(t=true)}if(o.callback){i!=="local"&&o.callback(t,void 0);i!=="global"&&r&&o.callback(t,r)}else{i!=="local"&&(o.value=o.type=="boolean"?!!t:t);i!=="global"&&r&&(r.state.vim.options[e]={value:t})}}function getOption(e,t,r){var n=d[e];r=r||{};var o=r.scope;if(!n)return new Error("Unknown option: "+e);if(n.callback){let e=t&&n.callback(void 0,t);return o!=="global"&&e!==void 0?e:o!=="local"?n.callback():void 0}{let r=o!=="global"&&t&&t.state.vim.options[e];return(r||o!=="local"&&n||{}).value}}defineOption("filetype",void 0,"string",["ft"],(function(e,t){if(t!==void 0){if(e===void 0){let e=t.getOption("mode");return e=="null"?"":e}{let r=e==""?"null":e;t.setOption("mode",r)}}}));defineOption("textwidth",80,"number",["tw"],(function(e,t){if(t!==void 0){if(e===void 0){var r=t.getOption("textwidth");return r}var n=Math.round(/**@type {any}*/e);n>1&&t.setOption("textwidth",n)}}));var createCircularJumpList=function(){var e=100;var t=-1;var r=0;var n=0;var o=new Array(e);function add(i,a,s){var l=t%e;var c=o[l];function useNextSlot(r){var n=++t%e;var a=o[n];a&&a.clear();o[n]=i.setBookmark(r)}if(c){var u=c.find();u&&!cursorEqual(u,a)&&useNextSlot(a)}else useNextSlot(a);useNextSlot(s);r=t;n=t-e+1;n<0&&(n=0)}function move(i,a){t+=a;t>r?t=r:t<n&&(t=n);var s=o[(e+t)%e];if(s&&!s.find()){var l=a>0?1:-1;var c;var u=i.getCursor();do{t+=l;s=o[(e+t)%e];if(s&&(c=s.find())&&!cursorEqual(u,c))break}while(t<r&&t>n)}return s}function find(e,r){var n=t;var o=move(e,r);t=n;return o&&o.find()}return{cachedCursor:void 0,add:add,find:find,move:move}};
/** 
   * Returns an object to track the changes associated insert mode.  It
   * clones the object that is passed in, or creates an empty object one if
   * none is provided.
   * @arg {import("./types").InsertModeChanges | undefined} [c]
   * @returns {import("./types").InsertModeChanges} 
   */var createInsertModeChanges=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:false}};class MacroModeState{constructor(){this.latestRegister=void 0;this.isPlaying=false;this.isRecording=false;this.replaySearchQueries=[];this.onRecordingDone=void 0;this.lastInsertModeChanges=createInsertModeChanges()}exitMacroRecordMode(){var e=p.macroModeState;e.onRecordingDone&&e.onRecordingDone();e.onRecordingDone=void 0;e.isRecording=false}enterMacroRecordMode(e,t){var r=p.registerController.getRegister(t);if(r){r.clear();this.latestRegister=t;if(e.openDialog){var n=dom("span",{class:"cm-vim-message"},"recording @"+t);this.onRecordingDone=e.openDialog(n,null,{bottom:true})}this.isRecording=true}}}function maybeInitVimState(e){e.state.vim||(e.state.vim={inputState:new InputState,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:false,insertModeReturn:false,insertModeRepeat:void 0,visualMode:false,visualLine:false,visualBlock:false,lastSelection:null,lastPastedText:null,sel:{},options:{},expectLiteralNext:false});return e.state.vim}
/**
   * @type { 
      {
        macroModeState: MacroModeState;
        registerController: RegisterController;
        searchHistoryController: HistoryController;
        jumpList: any;
        exCommandHistoryController: HistoryController; 
        lastCharacterSearch: any; 
        query?: any;
        isReversed?: any;
        lastSubstituteReplacePart: any;
        searchQuery?: null; 
        searchIsReversed?: boolean; 
      }
    }
  */var p;function resetVimGlobalState(){p={searchQuery:null,searchIsReversed:false,lastSubstituteReplacePart:void 0,jumpList:createCircularJumpList(),macroModeState:new MacroModeState,lastCharacterSearch:{increment:0,forward:true,selectedCharacter:""},registerController:new RegisterController({}),searchHistoryController:new HistoryController,exCommandHistoryController:new HistoryController};for(var e in d){var t=d[e];t.value=t.defaultValue}}
/** @type {number | undefined|false} */var m;var v={enterVimMode:enterVimMode,leaveVimMode:leaveVimMode,buildKeyMap:function(){},getRegisterController:function(){return p.registerController},resetVimGlobalState_:resetVimGlobalState,getVimGlobalState_:function(){return p},maybeInitVimState_:maybeInitVimState,suppressErrorLogging:false,InsertModeKey:InsertModeKey,
/**@type {(lhs: string, rhs: string, ctx: string) => void} */
map:function(e,t,r){B.map(e,t,r)},
/**@type {(lhs: string, ctx: string) => any} */
unmap:function(e,t){return B.unmap(e,t)},
/**@type {(lhs: string, rhs: string, ctx: string) => void} */
noremap:function(e,t,r){B.map(e,t,r,true)},mapclear:function(e){var t=r.length,o=n;var i=r.slice(0,t-o);r=r.slice(t-o);if(e)for(var a=i.length-1;a>=0;a--){var s=i[a];if(e!==s.context)if(s.context)this._mapCommand(s);else{var l=["normal","insert","visual"];for(var c in l)if(l[c]!==e){var u=Object.assign({},s);u.context=l[c];this._mapCommand(u)}}}},langmap:updateLangmap,vimKeyFromEvent:vimKeyFromEvent,setOption:setOption,getOption:getOption,defineOption:defineOption,
/**@type {(name: string, prefix: string|undefined, func: ExFn) => void} */
defineEx:function(e,t,r){if(t){if(e.indexOf(t)!==0)throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}else t=e;R[e]=r;B.commandMap_[t]={name:e,shortName:t,type:"api"}},
/**@type {(cm: CodeMirror, key: string, origin: string) => undefined | boolean} */
handleKey:function(e,t,r){var n=this.findKey(e,t,r);if(typeof n==="function")return n()},multiSelectHandleKey:multiSelectHandleKey,
/**@type {(cm_: CodeMirror, key: string, origin?: string| undefined) => (() => boolean) | undefined} */
findKey:function(e,t,n){var o=maybeInitVimState(e);var i=/**@type {CodeMirrorV}*/e;function handleMacroRecording(){var e=p.macroModeState;if(e.isRecording){if(t=="q"){e.exitMacroRecordMode();clearInputState(i);return true}n!="mapping"&&logKey(e,t)}}function handleEsc(){if(t=="<Esc>"){if(o.visualMode)exitVisualMode(i);else{if(!o.insertMode)return;exitInsertMode(i)}clearInputState(i);return true}}function handleKeyInsertMode(){if(handleEsc())return true;o.inputState.keyBuffer.push(t);var e=o.inputState.keyBuffer.join("");var n=t.length==1;var a=x.matchCommand(e,r,o.inputState,"insert");var s=o.inputState.changeQueue;if(a.type=="none"){clearInputState(i);return false}if(a.type=="partial"){a.expectLiteralNext&&(o.expectLiteralNext=true);m&&window.clearTimeout(m);m=n&&window.setTimeout((function(){o.insertMode&&o.inputState.keyBuffer.length&&clearInputState(i)}),getOption("insertModeEscKeysTimeout"));if(n){var l=i.listSelections();s&&s.removed.length==l.length||(s=o.inputState.changeQueue=new ChangeQueue);s.inserted+=t;for(var c=0;c<l.length;c++){var u=cursorMin(l[c].anchor,l[c].head);var h=cursorMax(l[c].anchor,l[c].head);var f=i.getRange(u,i.state.overwrite?offsetCursor(h,0,1):h);s.removed[c]=(s.removed[c]||"")+f}}return!n}o.expectLiteralNext=false;m&&window.clearTimeout(m);if(a.command&&s){l=i.listSelections();for(c=0;c<l.length;c++){var d=l[c].head;i.replaceRange(s.removed[c]||"",offsetCursor(d,0,-s.inserted.length),d,"+input")}p.macroModeState.lastInsertModeChanges.changes.pop()}a.command||clearInputState(i);return a.command}function handleKeyNonInsertMode(){if(handleMacroRecording()||handleEsc())return true;o.inputState.keyBuffer.push(t);var e=o.inputState.keyBuffer.join("");if(/^[1-9]\d*$/.test(e))return true;var n=/^(\d*)(.*)$/.exec(e);if(!n){clearInputState(i);return false}var a=o.visualMode?"visual":"normal";var s=n[2]||n[1];o.inputState.operatorShortcut&&o.inputState.operatorShortcut.slice(-1)==s&&(s=o.inputState.operatorShortcut);var l=x.matchCommand(s,r,o.inputState,a);if(l.type=="none"){clearInputState(i);return false}if(l.type=="partial"){l.expectLiteralNext&&(o.expectLiteralNext=true);return true}if(l.type=="clear"){clearInputState(i);return true}o.expectLiteralNext=false;o.inputState.keyBuffer.length=0;n=/^(\d*)(.*)$/.exec(e);n&&n[1]&&n[1]!="0"&&o.inputState.pushRepeatDigit(n[1]);return l.command}var a;a=o.insertMode?handleKeyInsertMode():handleKeyNonInsertMode();return a===false?o.insertMode||t.length!==1?void 0:function(){return true}:a===true?function(){return true}:function(){return i.operation((function(){i.curOp.isVimOp=true;try{a.type=="keyToKey"?doKeyToKey(i,a.toKeys,a):x.processCommand(i,o,a)}catch(e){i.state.vim=void 0;maybeInitVimState(i);v.suppressErrorLogging||console.log(e);throw e}return true}))}},handleEx:function(e,t){B.processCommand(e,t)},defineMotion:defineMotion,defineAction:defineAction,defineOperator:defineOperator,mapCommand:mapCommand,_mapCommand:_mapCommand,defineRegister:defineRegister,exitVisualMode:exitVisualMode,exitInsertMode:exitInsertMode};var g=[];var y=false;var C;function sendKeyToPrompt(e){if(e[0]=="<"){var t=e.toLowerCase().slice(1,-1);var r=t.split("-");t=r.pop()||"";if(t=="lt")e="<";else if(t=="space")e=" ";else if(t=="cr")e="\n";else if(k[t]){var n=C.value;var o={key:k[t],target:{value:n,selectionEnd:n.length,selectionStart:n.length}};C.onKeyDown&&C.onKeyDown(o,C.value,close);C&&C.onKeyUp&&C.onKeyUp(o,C.value,close);return}}if(e=="\n"){var i=C;C=null;i.onClose&&i.onClose(i.value)}else C.value=(C.value||"")+e;function close(e){typeof e=="string"?C.value=e:C=null}}function doKeyToKey(e,t,r){var n=y;if(r){if(g.indexOf(r)!=-1)return;g.push(r);y=r.noremap!=false}try{var o=maybeInitVimState(e);var i=/<(?:[CSMA]-)*\w+>|./gi;var a;while(a=i.exec(t)){var s=a[0];var l=o.insertMode;if(C)sendKeyToPrompt(s);else{var c=v.handleKey(e,s,"mapping");if(!c&&l&&o.insertMode){if(s[0]=="<"){var u=s.toLowerCase().slice(1,-1);var h=u.split("-");u=h.pop()||"";if(u=="lt")s="<";else if(u=="space")s=" ";else if(u=="cr")s="\n";else{if(k.hasOwnProperty(u)){s=k[u];sendCmKey(e,s);continue}s=s[0];i.lastIndex=a.index+1}}e.replaceSelection(s)}}}}finally{g.pop();y=!!g.length&&n;if(!g.length&&C){var f=C;C=null;showPrompt(e,f)}}}var w={Return:"CR",Backspace:"BS",Delete:"Del",Escape:"Esc",Insert:"Ins",ArrowLeft:"Left",ArrowRight:"Right",ArrowUp:"Up",ArrowDown:"Down",Enter:"CR"," ":"Space"};var S={Shift:1,Alt:1,Command:1,Control:1,CapsLock:1,AltGraph:1,Dead:1,Unidentified:1};var k={};"Left|Right|Up|Down|End|Home".split("|").concat(Object.keys(w)).forEach((function(e){k[(w[e]||"").toLowerCase()]=k[e.toLowerCase()]=e}));function vimKeyFromEvent(t,r){var n=t.key;if(!S[n]){n.length>1&&n[0]=="n"&&(n=n.replace("Numpad",""));n=w[n]||n;var o="";t.ctrlKey&&(o+="C-");t.altKey&&(o+="A-");t.metaKey&&(o+="M-");e.isMac&&t.altKey&&!t.metaKey&&!t.ctrlKey&&(o=o.slice(2));(o||n.length>1)&&t.shiftKey&&(o+="S-");if(r&&!r.expectLiteralNext&&n.length==1)if(i.keymap&&n in i.keymap)i.remapCtrl==false&&o||(n=i.keymap[n]);else if(n.charCodeAt(0)>255){var a=t.code?.slice(-1)||"";t.shiftKey||(a=a.toLowerCase());a&&(n=a)}o+=n;o.length>1&&(o="<"+o+">");return o}}function updateLangmap(e,t){i.string!==e&&(i=parseLangmap(e));i.remapCtrl=t}
/** 
   *  From :help langmap
   *  The 'langmap' option is a list of parts, separated with commas.  Each
   *      part can be in one of two forms:
   *      1.  A list of pairs.  Each pair is a "from" character immediately
   *          followed by the "to" character.  Examples: "aA", "aAbBcC".
   *      2.  A list of "from" characters, a semi-colon and a list of "to"
   *          characters.  Example: "abc;ABC"
   * @arg {string} langmapString
   * @returns {{string: string, keymap: Record<string, string>, remapCtrl?: boolean}}
   */function parseLangmap(e){let t={}/**@type {Record<string, string>}*/;if(!e)return{keymap:t,string:""};function getEscaped(e){return e.split(/\\?(.)/).filter(Boolean)}e.split(/((?:[^\\,]|\\.)+),/).map((e=>{if(!e)return;const r=e.split(/((?:[^\\;]|\\.)+);/);if(r.length==3){const e=getEscaped(r[1]);const n=getEscaped(r[2]);if(e.length!==n.length)return;for(let r=0;r<e.length;++r)t[e[r]]=n[r]}else if(r.length==1){const r=getEscaped(e);if(r.length%2!==0)return;for(let e=0;e<r.length;e+=2)t[r[e]]=r[e+1]}}));return{keymap:t,string:e}}defineOption("langmap",void 0,"string",["lmap"],(function(e,t){if(e===void 0)return i.string;updateLangmap(e)}));class InputState{constructor(){this.prefixRepeat=[];this.motionRepeat=[];this.operator=null;this.operatorArgs=null;this.motion=null;this.motionArgs=null;this.keyBuffer=[];this.registerName=null;this.changeQueue=null}pushRepeatDigit(e){this.operator?this.motionRepeat=this.motionRepeat.concat(e):this.prefixRepeat=this.prefixRepeat.concat(e)}getRepeat(){var e=0;if(this.prefixRepeat.length>0||this.motionRepeat.length>0){e=1;this.prefixRepeat.length>0&&(e*=parseInt(this.prefixRepeat.join(""),10));this.motionRepeat.length>0&&(e*=parseInt(this.motionRepeat.join(""),10))}return e}}function clearInputState(t,r){t.state.vim.inputState=new InputState;t.state.vim.expectLiteralNext=false;e.signal(t,"vim-command-done",r)}function ChangeQueue(){this.removed=[];this.inserted=""}class Register{constructor(e,t,r){this.clear();this.keyBuffer=[e||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!t;this.blockwise=!!r}setText(e,t,r){this.keyBuffer=[e||""];this.linewise=!!t;this.blockwise=!!r}pushText(e,t){if(t){this.linewise||this.keyBuffer.push("\n");this.linewise=true}this.keyBuffer.push(e)}pushInsertModeChanges(e){this.insertModeChanges.push(createInsertModeChanges(e))}pushSearchQuery(e){this.searchQueries.push(e)}clear(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=false}toString(){return this.keyBuffer.join("")}}function defineRegister(e,t){var r=p.registerController.registers;if(!e||e.length!=1)throw Error("Register name must be 1 character");if(r[e])throw Error("Register already defined "+e);r[e]=t;u.push(e)}class RegisterController{constructor(e){this.registers=e;this.unnamedRegister=e['"']=new Register;e["."]=new Register;e[":"]=new Register;e["/"]=new Register;e["+"]=new Register}pushText(e,t,r,n,o){if(e!=="_"){n&&r.charAt(r.length-1)!=="\n"&&(r+="\n");var i=this.isValidRegister(e)?this.getRegister(e):null;if(i){var a=isUpperCase(e);a?i.pushText(r,n):i.setText(r,n,o);e==="+"&&navigator.clipboard.writeText(r);this.unnamedRegister.setText(i.toString(),n)}else{switch(t){case"yank":this.registers[0]=new Register(r,n,o);break;case"delete":case"change":if(r.indexOf("\n")==-1)this.registers["-"]=new Register(r,n);else{this.shiftNumericRegisters_();this.registers[1]=new Register(r,n)}break}this.unnamedRegister.setText(r,n,o)}}}getRegister(e){if(!this.isValidRegister(e))return this.unnamedRegister;e=e.toLowerCase();this.registers[e]||(this.registers[e]=new Register);return this.registers[e]}
/**@type {{(name: any): name is string}} */isValidRegister(e){return e&&(inArray(e,u)||h.test(e))}shiftNumericRegisters_(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}}class HistoryController{constructor(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}nextMatch(e,t){var r=this.historyBuffer;var n=t?-1:1;this.initialPrefix===null&&(this.initialPrefix=e);for(var o=this.iterator+n;t?o>=0:o<r.length;o+=n){var i=r[o];for(var a=0;a<=i.length;a++)if(this.initialPrefix==i.substring(0,a)){this.iterator=o;return i}}if(o>=r.length){this.iterator=r.length;return this.initialPrefix}if(o<0)return e}pushInput(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1);e.length&&this.historyBuffer.push(e)}reset(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}}var x={matchCommand:function(e,t,r,n){var o=commandMatches(e,t,n,r);if(!o.full&&!o.partial)return{type:"none"};if(!o.full&&o.partial)return{type:"partial",expectLiteralNext:o.partial.length==1&&o.partial[0].keys.slice(-11)=="<character>"};var i;for(var a=0;a<o.full.length;a++){var s=o.full[a];i||(i=s)}if(i.keys.slice(-11)=="<character>"||i.keys.slice(-10)=="<register>"){var l=lastChar(e);if(!l||l.length>1)return{type:"clear"};r.selectedCharacter=l}return{type:"full",command:i}},processCommand:function(e,t,r){t.inputState.repeatOverride=r.repeatOverride;switch(r.type){case"motion":this.processMotion(e,t,r);break;case"operator":this.processOperator(e,t,r);break;case"operatorMotion":this.processOperatorMotion(e,t,r);break;case"action":this.processAction(e,t,r);break;case"search":this.processSearch(e,t,r);break;case"ex":case"keyToEx":this.processEx(e,t,r);break}},processMotion:function(e,t,r){t.inputState.motion=r.motion;t.inputState.motionArgs=/**@type {MotionArgs}*/copyArgs(r.motionArgs);this.evalInput(e,t)},processOperator:function(e,t,r){var n=t.inputState;if(n.operator){if(n.operator==r.operator){n.motion="expandToLine";n.motionArgs={linewise:true,repeat:1};this.evalInput(e,t);return}clearInputState(e)}n.operator=r.operator;n.operatorArgs=copyArgs(r.operatorArgs);r.keys.length>1&&(n.operatorShortcut=r.keys);if(r.exitVisualBlock){t.visualBlock=false;updateCmSelection(e)}t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,r){var n=t.visualMode;var o=copyArgs(r.operatorMotionArgs);o&&n&&o.visualLine&&(t.visualLine=true);this.processOperator(e,t,r);n||this.processMotion(e,t,r)},processAction:function(e,t,r){var n=t.inputState;var o=n.getRepeat();var i=!!o;var a=/**@type {ActionArgs}*/copyArgs(r.actionArgs)||{repeat:1};n.selectedCharacter&&(a.selectedCharacter=n.selectedCharacter);r.operator&&this.processOperator(e,t,r);r.motion&&this.processMotion(e,t,r);(r.motion||r.operator)&&this.evalInput(e,t);a.repeat=o||1;a.repeatIsExplicit=i;a.registerName=n.registerName;clearInputState(e);t.lastMotion=null;r.isEdit&&this.recordLastEdit(t,n,r);b[r.action](e,a,t)},processSearch:function(t,r,n){if(t.getSearchCursor){var o=n.searchArgs.forward;var i=n.searchArgs.wholeWordOnly;getSearchState(t).setReversed(!o);var a=o?"/":"?";var s=getSearchState(t).getQuery();var l=t.getScrollInfo();switch(n.searchArgs.querySrc){case"prompt":var c=p.macroModeState;if(c.isPlaying){let e=c.replaySearchQueries.shift();handleQuery(e,true,false)}else showPrompt(t,{onClose:onPromptClose,prefix:a,desc:"(JavaScript regexp)",onKeyUp:onPromptKeyUp,onKeyDown:onPromptKeyDown});break;case"wordUnderCursor":var u=expandWordUnderCursor(t,{noSymbol:true});var h=true;if(!u){u=expandWordUnderCursor(t,{noSymbol:false});h=false}if(!u){showConfirm(t,"No word under cursor");clearInputState(t);return}let e=t.getLine(u.start.line).substring(u.start.ch,u.end.ch);e=h&&i?"\\b"+e+"\\b":escapeRegex(e);p.jumpList.cachedCursor=t.getCursor();t.setCursor(u.start);handleQuery(e,true,false);break}}function handleQuery(e,o,i){p.searchHistoryController.pushInput(e);p.searchHistoryController.reset();try{updateSearchQuery(t,e,o,i)}catch(r){showConfirm(t,"Invalid regex: "+e);clearInputState(t);return}x.processMotion(t,r,{keys:"",type:"motion",motion:"findNext",motionArgs:{forward:true,toJumplist:n.searchArgs.toJumplist}})}function onPromptClose(e){t.scrollTo(l.left,l.top);handleQuery(e,true,true);var r=p.macroModeState;r.isRecording&&logSearchQuery(r,e)}function onPromptKeyUp(e,r,n){var i,a,s=vimKeyFromEvent(e);if(s=="<Up>"||s=="<Down>"){i=s=="<Up>";a=e.target?e.target.selectionEnd:0;r=p.searchHistoryController.nextMatch(r,i)||"";n(r);a&&e.target&&(e.target.selectionEnd=e.target.selectionStart=Math.min(a,e.target.value.length))}else s&&s!="<Left>"&&s!="<Right>"&&p.searchHistoryController.reset();var c;try{c=updateSearchQuery(t,r,true,true)}catch(e){}if(c)t.scrollIntoView(findNext(t,!o,c),30);else{clearSearchHighlight(t);t.scrollTo(l.left,l.top)}}function onPromptKeyDown(r,n,o){var i=vimKeyFromEvent(r);if(i=="<Esc>"||i=="<C-c>"||i=="<C-[>"||i=="<BS>"&&n==""){p.searchHistoryController.pushInput(n);p.searchHistoryController.reset();updateSearchQuery(t,s);clearSearchHighlight(t);t.scrollTo(l.left,l.top);e.e_stop(r);clearInputState(t);o();t.focus()}else if(i=="<Up>"||i=="<Down>")e.e_stop(r);else if(i=="<C-u>"){e.e_stop(r);o("")}}},processEx:function(t,r,n){function onPromptClose(e){p.exCommandHistoryController.pushInput(e);p.exCommandHistoryController.reset();B.processCommand(t,e);t.state.vim&&clearInputState(t)}function onPromptKeyDown(r,n,o){var i,a,s=vimKeyFromEvent(r);if(s=="<Esc>"||s=="<C-c>"||s=="<C-[>"||s=="<BS>"&&n==""){p.exCommandHistoryController.pushInput(n);p.exCommandHistoryController.reset();e.e_stop(r);clearInputState(t);o();t.focus()}if(s=="<Up>"||s=="<Down>"){e.e_stop(r);i=s=="<Up>";a=r.target?r.target.selectionEnd:0;n=p.exCommandHistoryController.nextMatch(n,i)||"";o(n);a&&r.target&&(r.target.selectionEnd=r.target.selectionStart=Math.min(a,r.target.value.length))}else if(s=="<C-u>"){e.e_stop(r);o("")}else s&&s!="<Left>"&&s!="<Right>"&&p.exCommandHistoryController.reset()}n.type=="keyToEx"?B.processCommand(t,n.exArgs.input):r.visualMode?showPrompt(t,{onClose:onPromptClose,prefix:":",value:"'<,'>",onKeyDown:onPromptKeyDown,selectValueOnOpen:false}):showPrompt(t,{onClose:onPromptClose,prefix:":",onKeyDown:onPromptKeyDown})},evalInput:function(e,r){var n=r.inputState;var o=n.motion;
/** @type {MotionArgs}*/var i=n.motionArgs||{repeat:1};var a=n.operator;
/** @type {OperatorArgs}*/var s=n.operatorArgs||{};var l=n.registerName;var c=r.sel;var u=copyCursor(r.visualMode?clipCursorToContent(e,c.head):e.getCursor("head"));var h=copyCursor(r.visualMode?clipCursorToContent(e,c.anchor):e.getCursor("anchor"));var f=copyCursor(u);var d=copyCursor(h);var m,v;var g;a&&this.recordLastEdit(r,n);g=n.repeatOverride!==void 0?n.repeatOverride:n.getRepeat();if(g>0&&i.explicitRepeat)i.repeatIsExplicit=true;else if(i.noRepeat||!i.explicitRepeat&&g===0){g=1;i.repeatIsExplicit=false}n.selectedCharacter&&(i.selectedCharacter=s.selectedCharacter=n.selectedCharacter);i.repeat=g;clearInputState(e);if(o){var y=M[o](e,u,i,r,n);r.lastMotion=M[o];if(!y)return;if(i.toJumplist){var C=p.jumpList;var w=C.cachedCursor;if(w){recordJumpPosition(e,w,y);delete C.cachedCursor}else recordJumpPosition(e,u,y)}if(y instanceof Array){v=y[0];m=y[1]}else m=y;m||(m=copyCursor(u));if(r.visualMode){r.visualBlock&&m.ch===Infinity||(m=clipCursorToContent(e,m,f));v&&(v=clipCursorToContent(e,v));v=v||d;c.anchor=v;c.head=m;updateCmSelection(e);updateMark(e,r,"<",cursorIsBefore(v,m)?v:m);updateMark(e,r,">",cursorIsBefore(v,m)?m:v)}else if(!a){m=clipCursorToContent(e,m,f);e.setCursor(m.line,m.ch)}}if(a){if(s.lastSel){v=d;var S=s.lastSel;var k=Math.abs(S.head.line-S.anchor.line);var x=Math.abs(S.head.ch-S.anchor.ch);m=S.visualLine?new t(d.line+k,d.ch):S.visualBlock?new t(d.line+k,d.ch+x):S.head.line==S.anchor.line?new t(d.line,d.ch+x):new t(d.line+k,d.ch);r.visualMode=true;r.visualLine=S.visualLine;r.visualBlock=S.visualBlock;c=r.sel={anchor:v,head:m};updateCmSelection(e)}else r.visualMode&&(s.lastSel={anchor:copyCursor(c.anchor),head:copyCursor(c.head),visualBlock:r.visualBlock,visualLine:r.visualLine});var b,A,E;
/** @type {'block'|'line'|'char'}*/var T;var O;if(r.visualMode){b=cursorMin(c.head,c.anchor);A=cursorMax(c.head,c.anchor);E=r.visualLine||s.linewise;T=r.visualBlock?"block":E?"line":"char";var I=updateSelectionForSurrogateCharacters(e,b,A);O=makeCmSelection(e,{anchor:I.start,head:I.end},T);if(E){var R=O.ranges;if(T=="block")for(var B=0;B<R.length;B++)R[B].head.ch=lineLength(e,R[B].head.line);else T=="line"&&(R[0].head=new t(R[0].head.line+1,0))}}else{b=copyCursor(v||d);A=copyCursor(m||f);if(cursorIsBefore(A,b)){var N=b;b=A;A=N}E=i.linewise||s.linewise;E?expandSelectionToLine(e,b,A):i.forward&&clipToLine(e,b,A);T="char";var K=!i.inclusive||E;I=updateSelectionForSurrogateCharacters(e,b,A);O=makeCmSelection(e,{anchor:I.start,head:I.end},T,K)}e.setSelections(O.ranges,O.primary);r.lastMotion=null;s.repeat=g;s.registerName=l;s.linewise=E;var P=L[a](e,s,O.ranges,d,m);r.visualMode&&exitVisualMode(e,P!=null);P&&e.setCursor(P)}},recordLastEdit:function(e,t,r){var n=p.macroModeState;if(!n.isPlaying){e.lastEditInputState=t;e.lastEditActionCommand=r;n.lastInsertModeChanges.changes=[];n.lastInsertModeChanges.expectCursorActivityForChange=false;n.lastInsertModeChanges.visualBlock=e.visualBlock?e.sel.head.line-e.sel.anchor.line:0}}};
/**
   * All of the functions below return Cursor objects.
   * @type {import("./types").vimMotions}}
   */var M={moveToTopLine:function(e,r,n){var o=getUserVisibleLines(e).top+n.repeat-1;return new t(o,findFirstNonWhiteSpaceCharacter(e.getLine(o)))},moveToMiddleLine:function(e){var r=getUserVisibleLines(e);var n=Math.floor((r.top+r.bottom)*.5);return new t(n,findFirstNonWhiteSpaceCharacter(e.getLine(n)))},moveToBottomLine:function(e,r,n){var o=getUserVisibleLines(e).bottom-n.repeat+1;return new t(o,findFirstNonWhiteSpaceCharacter(e.getLine(o)))},expandToLine:function(e,r,n){var o=r;return new t(o.line+n.repeat-1,Infinity)},findNext:function(e,t,r){var n=getSearchState(e);var o=n.getQuery();if(o){var i=!r.forward;i=n.isReversed()?!i:i;highlightSearchMatches(e,o);return findNext(e,i,o,r.repeat)}},findAndSelectNextInclusive:function(r,n,o,i,a){var s=getSearchState(r);var l=s.getQuery();if(l){var c=!o.forward;c=s.isReversed()?!c:c;var u=findNextFromAndToInclusive(r,c,l,o.repeat,i);if(u){if(a.operator)return u;var h=u[0];var f=new t(u[1].line,u[1].ch-1);if(i.visualMode){if(i.visualLine||i.visualBlock){i.visualLine=false;i.visualBlock=false;e.signal(r,"vim-mode-change",{mode:"visual",subMode:""})}var d=i.sel.anchor;if(d)return s.isReversed()?o.forward?[d,h]:[d,f]:o.forward?[d,f]:[d,h]}else{i.visualMode=true;i.visualLine=false;i.visualBlock=false;e.signal(r,"vim-mode-change",{mode:"visual",subMode:""})}return c?[f,h]:[h,f]}}},goToMark:function(e,t,r,n){var o=getMarkPos(e,n,r.selectedCharacter||"");return o?r.linewise?{line:o.line,ch:findFirstNonWhiteSpaceCharacter(e.getLine(o.line))}:o:null},moveToOtherHighlightedEnd:function(e,r,n,o){if(o.visualBlock&&n.sameLine){var i=o.sel;return[clipCursorToContent(e,new t(i.anchor.line,i.head.ch)),clipCursorToContent(e,new t(i.head.line,i.anchor.ch))]}return[o.sel.head,o.sel.anchor]},jumpToMark:function(e,r,n,o){var i=r;for(var a=0;a<n.repeat;a++){var s=i;for(var l in o.marks)if(isLowerCase(l)){var c=o.marks[l].find();var u=n.forward?cursorIsBefore(c,s):cursorIsBefore(s,c);if(!u&&(!n.linewise||c.line!=s.line)){var h=cursorEqual(s,i);var f=n.forward?cursorIsBetween(s,c,i):cursorIsBetween(i,c,s);(h||f)&&(i=c)}}}n.linewise&&(i=new t(i.line,findFirstNonWhiteSpaceCharacter(e.getLine(i.line))));return i},moveByCharacters:function(e,r,n){var o=r;var i=n.repeat;var a=n.forward?o.ch+i:o.ch-i;return new t(o.line,a)},moveByLines:function(e,r,n,o){var i=r;var a=i.ch;switch(o.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:a=o.lastHPos;break;default:o.lastHPos=a}var s=n.repeat+(n.repeatOffset||0);var l=n.forward?i.line+s:i.line-s;var c=e.firstLine();var u=e.lastLine();var h=e.findPosV(i,n.forward?s:-s,"line",o.lastHSPos);var f=n.forward?h.line>l:h.line<l;if(f){l=h.line;a=h.ch}if(l<c&&i.line==c)return this.moveToStartOfLine(e,r,n,o);if(l>u&&i.line==u)return moveToEol(e,r,n,o,true);if(n.toFirstChar){a=findFirstNonWhiteSpaceCharacter(e.getLine(l));o.lastHPos=a}o.lastHSPos=e.charCoords(new t(l,a),"div").left;return new t(l,a)},moveByDisplayLines:function(e,r,n,o){var i=r;switch(o.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:o.lastHSPos=e.charCoords(i,"div").left}var a=n.repeat;var s=e.findPosV(i,n.forward?a:-a,"line",o.lastHSPos);if(s.hitSide)if(n.forward){var l=e.charCoords(s,"div");var c={top:l.top+8,left:o.lastHSPos};s=e.coordsChar(c,"div")}else{var u=e.charCoords(new t(e.firstLine(),0),"div");u.left=o.lastHSPos;s=e.coordsChar(u,"div")}o.lastHPos=s.ch;return s},moveByPage:function(e,t,r){var n=t;var o=r.repeat;return e.findPosV(n,r.forward?o:-o,"page")},moveByParagraph:function(e,t,r){var n=r.forward?1:-1;return findParagraph(e,t,r.repeat,n).start},moveBySentence:function(e,t,r){var n=r.forward?1:-1;return findSentence(e,t,r.repeat,n)},moveByScroll:function(e,t,r,n){var o=e.getScrollInfo();var i=null;var a=r.repeat;a||(a=o.clientHeight/(2*e.defaultTextHeight()));var s=e.charCoords(t,"local");r.repeat=a;i=M.moveByDisplayLines(e,t,r,n);if(!i)return null;var l=e.charCoords(i,"local");e.scrollTo(null,o.top+l.top-s.top);return i},moveByWords:function(e,t,r){return moveToWord(e,t,r.repeat,!!r.forward,!!r.wordEnd,!!r.bigWord)},moveTillCharacter:function(e,t,r){var n=r.repeat;var o=moveToCharacter(e,n,r.forward,r.selectedCharacter,t);var i=r.forward?-1:1;recordLastCharacterSearch(i,r);if(!o)return null;o.ch+=i;return o},moveToCharacter:function(e,t,r){var n=r.repeat;recordLastCharacterSearch(0,r);return moveToCharacter(e,n,r.forward,r.selectedCharacter,t)||t},moveToSymbol:function(e,t,r){var n=r.repeat;return r.selectedCharacter&&findSymbol(e,n,r.forward,r.selectedCharacter)||t},moveToColumn:function(e,t,r,n){var o=r.repeat;n.lastHPos=o-1;n.lastHSPos=e.charCoords(t,"div").left;return moveToColumn(e,o)},moveToEol:function(e,t,r,n){return moveToEol(e,t,r,n,false)},moveToFirstNonWhiteSpaceCharacter:function(e,r){var n=r;return new t(n.line,findFirstNonWhiteSpaceCharacter(e.getLine(n.line)))},moveToMatchedSymbol:function(e,r){var n=r;var o=n.line;var i=n.ch;var a=e.getLine(o);var s;for(;i<a.length;i++){s=a.charAt(i);if(s&&isMatchableSymbol(s)){var l=e.getTokenTypeAt(new t(o,i+1));if(l!=="string"&&l!=="comment")break}}if(i<a.length){var c=s==="<"||s===">"?/[(){}[\]<>]/:/[(){}[\]]/;var u=e.findMatchingBracket(new t(o,i),{bracketRegex:c});return u.to}return n},moveToStartOfLine:function(e,r){return new t(r.line,0)},moveToLineOrEdgeOfDocument:function(e,r,n){var o=n.forward?e.lastLine():e.firstLine();n.repeatIsExplicit&&(o=n.repeat-e.getOption("firstLineNumber"));return new t(o,findFirstNonWhiteSpaceCharacter(e.getLine(o)))},moveToStartOfDisplayLine:function(e){e.execCommand("goLineLeft");return e.getCursor()},moveToEndOfDisplayLine:function(e){e.execCommand("goLineRight");var t=e.getCursor();t.sticky=="before"&&t.ch--;return t},textObjectManipulation:function(e,t,r,n){
/** @type{Object<string, string>} */
var o={"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"};
/** @type{Object<string, boolean>} */var i={"'":true,'"':true,"`":true};var a=r.selectedCharacter||"";a=="b"?a="(":a=="B"&&(a="{");var s=!r.textObjectInner;var l,c;if(o[a]){c=true;l=selectCompanionObject(e,t,a,s);if(!l){var u=e.getSearchCursor(new RegExp("\\"+a,"g"),t);u.find()&&(l=selectCompanionObject(e,u.from(),a,s))}}else if(i[a]){c=true;l=findBeginningAndEnd(e,t,a,s)}else if(a==="W"||a==="w"){var h=r.repeat||1;while(h-- >0){var f=expandWordUnderCursor(e,{inclusive:s,innerWord:!s,bigWord:a==="W",noSymbol:a==="W",multiline:true},l&&l.end);if(f){l||(l=f);l.end=f.end}}}else if(a==="p"){l=findParagraph(e,t,r.repeat,0,s);r.linewise=true;if(n.visualMode)n.visualLine||(n.visualLine=true);else{var d=n.inputState.operatorArgs;d&&(d.linewise=true);l.end.line--}}else if(a==="t")l=expandTagUnderCursor(e,t,s);else if(a==="s"){var p=e.getLine(t.line);t.ch>0&&isEndOfSentenceSymbol(p[t.ch])&&(t.ch-=1);var m=getSentence(e,t,r.repeat,1,s);var v=getSentence(e,t,r.repeat,-1,s);isWhiteSpaceString(e.getLine(v.line)[v.ch])&&isWhiteSpaceString(e.getLine(m.line)[m.ch-1])&&(v={line:v.line,ch:v.ch+1});l={start:v,end:m}}return l?e.state.vim.visualMode?expandSelection(e,l.start,l.end,c):[l.start,l.end]:null},repeatLastCharacterSearch:function(e,t,r){var n=p.lastCharacterSearch;var o=r.repeat;var i=r.forward===n.forward;var a=(n.increment?1:0)*(i?-1:1);e.moveH(-a,"char");r.inclusive=!!i;var s=moveToCharacter(e,o,i,n.selectedCharacter);if(!s){e.moveH(a,"char");return t}s.ch+=a;return s}};function defineMotion(e,t){M[e]=t}function fillArray(e,t){var r=[];for(var n=0;n<t;n++)r.push(e);return r}
/** @type {import("./types").vimOperators} */var L={change:function(e,r,n){var o,i;var a=e.state.vim;var s=n[0].anchor,l=n[0].head;if(a.visualMode)if(r.fullLine){l.ch=Number.MAX_VALUE;l.line--;e.setSelection(s,l);i=e.getSelection();e.replaceSelection("");o=s}else{i=e.getSelection();var c=fillArray("",n.length);e.replaceSelections(c);o=cursorMin(n[0].head,n[0].anchor)}else{i=e.getRange(s,l);var u=a.lastEditInputState;if(u?.motion=="moveByWords"&&!isWhiteSpaceString(i)){var h=/\s+$/.exec(i);if(h&&u.motionArgs&&u.motionArgs.forward){l=offsetCursor(l,0,-h[0].length);i=i.slice(0,-h[0].length)}}if(r.linewise){s=new t(s.line,findFirstNonWhiteSpaceCharacter(e.getLine(s.line)));l.line>s.line&&(l=new t(l.line-1,Number.MAX_VALUE))}e.replaceRange("",s,l);o=s}p.registerController.pushText(r.registerName,"change",i,r.linewise,n.length>1);b.enterInsertMode(e,{head:o},e.state.vim)},delete:function(e,r,n){var o,i;var a=e.state.vim;if(a.visualBlock){i=e.getSelection();var s=fillArray("",n.length);e.replaceSelections(s);o=cursorMin(n[0].head,n[0].anchor)}else{var l=n[0].anchor,c=n[0].head;r.linewise&&c.line!=e.firstLine()&&l.line==e.lastLine()&&l.line==c.line-1&&(l.line==e.firstLine()?l.ch=0:l=new t(l.line-1,lineLength(e,l.line-1)));i=e.getRange(l,c);e.replaceRange("",l,c);o=l;r.linewise&&(o=M.moveToFirstNonWhiteSpaceCharacter(e,l))}p.registerController.pushText(r.registerName,"delete",i,r.linewise,a.visualBlock);return clipCursorToContent(e,o)},indent:function(e,t,r){var n=e.state.vim;var o=n.visualMode?t.repeat||0:1;if(e.indentMore)for(var i=0;i<o;i++)t.indentRight?e.indentMore():e.indentLess();else{var a=r[0].anchor.line;var s=n.visualBlock?r[r.length-1].anchor.line:r[0].head.line;t.linewise&&s--;for(var l=a;l<=s;l++)for(i=0;i<o;i++)e.indentLine(l,t.indentRight)}return M.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},indentAuto:function(e,t,r){e.execCommand("indentAuto");return M.moveToFirstNonWhiteSpaceCharacter(e,r[0].anchor)},hardWrap:function(e,r,n,o){if(e.hardWrap){var i=n[0].anchor.line;var a=n[0].head.line;r.linewise&&a--;var s=e.hardWrap({from:i,to:a});s>i&&r.linewise&&s--;return r.keepCursor?o:new t(s,0)}},changeCase:function(e,t,r,n,o){var i=e.getSelections();var a=[];var s=t.toLower;for(var l=0;l<i.length;l++){var c=i[l];var u="";if(s===true)u=c.toLowerCase();else if(s===false)u=c.toUpperCase();else for(var h=0;h<c.length;h++){var f=c.charAt(h);u+=isUpperCase(f)?f.toLowerCase():f.toUpperCase()}a.push(u)}e.replaceSelections(a);return t.shouldMoveCursor?o:!e.state.vim.visualMode&&t.linewise&&r[0].anchor.line+1==r[0].head.line?M.moveToFirstNonWhiteSpaceCharacter(e,n):t.linewise?n:cursorMin(r[0].anchor,r[0].head)},yank:function(e,t,r,n){var o=e.state.vim;var i=e.getSelection();var a=o.visualMode?cursorMin(o.sel.anchor,o.sel.head,r[0].head,r[0].anchor):n;p.registerController.pushText(t.registerName,"yank",i,t.linewise,o.visualBlock);return a}};function defineOperator(e,t){L[e]=t}
/** @type {import("./types").vimActions} */var b={jumpListWalk:function(e,t,r){if(!r.visualMode){var n=t.repeat||1;var o=t.forward;var i=p.jumpList;var a=i.move(e,o?n:-n);var s=a?a.find():void 0;s=s||e.getCursor();e.setCursor(s)}},scroll:function(e,t,r){if(!r.visualMode){var n=t.repeat||1;var o=e.defaultTextHeight();var i=e.getScrollInfo().top;var a=o*n;var s=t.forward?i+a:i-a;var l=copyCursor(e.getCursor());var c=e.charCoords(l,"local");if(t.forward)if(s>c.top){l.line+=(s-c.top)/o;l.line=Math.ceil(l.line);e.setCursor(l);c=e.charCoords(l,"local");e.scrollTo(null,c.top)}else e.scrollTo(null,s);else{var u=s+e.getScrollInfo().clientHeight;if(u<c.bottom){l.line-=(c.bottom-u)/o;l.line=Math.floor(l.line);e.setCursor(l);c=e.charCoords(l,"local");e.scrollTo(null,c.bottom-e.getScrollInfo().clientHeight)}else e.scrollTo(null,s)}}},scrollToCursor:function(e,r){var n=e.getCursor().line;var o=e.charCoords(new t(n,0),"local");var i=e.getScrollInfo().clientHeight;var a=o.top;switch(r.position){case"center":a=o.bottom-i/2;break;case"bottom":var s=new t(n,e.getLine(n).length-1);var l=e.charCoords(s,"local");var c=l.bottom-a;a=a-i+c;break}e.scrollTo(null,a)},replayMacro:function(e,t,r){var n=t.selectedCharacter||"";var o=t.repeat||1;var i=p.macroModeState;n=="@"?n=i.latestRegister:i.latestRegister=n;while(o--)executeMacroRegister(e,r,i,n)},enterMacroRecordMode:function(e,t){var r=p.macroModeState;var n=t.selectedCharacter;p.registerController.isValidRegister(n)&&r.enterMacroRecordMode(e,n)},toggleOverwrite:function(t){if(t.state.overwrite){t.toggleOverwrite(false);t.setOption("keyMap","vim-insert");e.signal(t,"vim-mode-change",{mode:"insert"})}else{t.toggleOverwrite(true);t.setOption("keyMap","vim-replace");e.signal(t,"vim-mode-change",{mode:"replace"})}},enterInsertMode:function(r,n,o){if(!r.getOption("readOnly")){o.insertMode=true;o.insertModeRepeat=n&&n.repeat||1;var i=n?n.insertAt:null;var a=o.sel;var s=n.head||r.getCursor("head");var l=r.listSelections().length;if(i=="eol")s=new t(s.line,lineLength(r,s.line));else if(i=="bol")s=new t(s.line,0);else if(i=="charAfter"){var c=updateSelectionForSurrogateCharacters(r,s,offsetCursor(s,0,1));s=c.end}else if(i=="firstNonBlank"){c=updateSelectionForSurrogateCharacters(r,s,M.moveToFirstNonWhiteSpaceCharacter(r,s));s=c.end}else if(i=="startOfSelectedArea"){if(!o.visualMode)return;if(o.visualBlock){s=new t(Math.min(a.head.line,a.anchor.line),Math.min(a.head.ch,a.anchor.ch));l=Math.abs(a.head.line-a.anchor.line)+1}else s=a.head.line<a.anchor.line?a.head:new t(a.anchor.line,0)}else if(i=="endOfSelectedArea"){if(!o.visualMode)return;if(o.visualBlock){s=new t(Math.min(a.head.line,a.anchor.line),Math.max(a.head.ch,a.anchor.ch)+1);l=Math.abs(a.head.line-a.anchor.line)+1}else s=a.head.line>=a.anchor.line?offsetCursor(a.head,0,1):new t(a.anchor.line,0)}else if(i=="inplace"){if(o.visualMode)return}else i=="lastEdit"&&(s=getLastEditPos(r)||s);r.setOption("disableInput",false);if(n&&n.replace){r.toggleOverwrite(true);r.setOption("keyMap","vim-replace");e.signal(r,"vim-mode-change",{mode:"replace"})}else{r.toggleOverwrite(false);r.setOption("keyMap","vim-insert");e.signal(r,"vim-mode-change",{mode:"insert"})}if(!p.macroModeState.isPlaying){r.on("change",onChange);o.insertEnd&&o.insertEnd.clear();o.insertEnd=r.setBookmark(s,{insertLeft:true});e.on(r.getInputField(),"keydown",onKeyEventTargetKeyDown)}o.visualMode&&exitVisualMode(r);selectForInsert(r,s,l)}},toggleVisualMode:function(r,n,o){var i=n.repeat;var a=r.getCursor();var s;if(o.visualMode)if(o.visualLine!=!!n.linewise||o.visualBlock!=!!n.blockwise){o.visualLine=!!n.linewise;o.visualBlock=!!n.blockwise;e.signal(r,"vim-mode-change",{mode:"visual",subMode:o.visualLine?"linewise":o.visualBlock?"blockwise":""});updateCmSelection(r)}else exitVisualMode(r);else{o.visualMode=true;o.visualLine=!!n.linewise;o.visualBlock=!!n.blockwise;s=clipCursorToContent(r,new t(a.line,a.ch+i-1));var l=updateSelectionForSurrogateCharacters(r,a,s);o.sel={anchor:l.start,head:l.end};e.signal(r,"vim-mode-change",{mode:"visual",subMode:o.visualLine?"linewise":o.visualBlock?"blockwise":""});updateCmSelection(r);updateMark(r,o,"<",cursorMin(a,s));updateMark(r,o,">",cursorMax(a,s))}},reselectLastSelection:function(t,r,n){var o=n.lastSelection;n.visualMode&&updateLastSelection(t,n);if(o){var i=o.anchorMark.find();var a=o.headMark.find();if(!i||!a)return;n.sel={anchor:i,head:a};n.visualMode=true;n.visualLine=o.visualLine;n.visualBlock=o.visualBlock;updateCmSelection(t);updateMark(t,n,"<",cursorMin(i,a));updateMark(t,n,">",cursorMax(i,a));e.signal(t,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""})}},joinLines:function(e,r,n){var o,i;if(n.visualMode){o=e.getCursor("anchor");i=e.getCursor("head");if(cursorIsBefore(i,o)){var a=i;i=o;o=a}i.ch=lineLength(e,i.line)-1}else{var s=Math.max(r.repeat,2);o=e.getCursor();i=clipCursorToContent(e,new t(o.line+s-1,Infinity))}var l=0;for(var c=o.line;c<i.line;c++){l=lineLength(e,o.line);var u="";var h=0;if(!r.keepSpaces){var f=e.getLine(o.line+1);h=f.search(/\S/);h==-1?h=f.length:u=" "}e.replaceRange(u,new t(o.line,l),new t(o.line+1,h))}var d=clipCursorToContent(e,new t(o.line,l));n.visualMode&&exitVisualMode(e,false);e.setCursor(d)},newLineAndEnterInsertMode:function(r,n,o){o.insertMode=true;var i=copyCursor(r.getCursor());if(i.line!==r.firstLine()||n.after){i.line=n.after?i.line:i.line-1;i.ch=lineLength(r,i.line);r.setCursor(i);var a=e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent;a(r)}else{r.replaceRange("\n",new t(r.firstLine(),0));r.setCursor(r.firstLine(),0)}this.enterInsertMode(r,{repeat:n.repeat},o)},paste:function(e,t,r){var n=p.registerController.getRegister(t.registerName);if(t.registerName==="+")navigator.clipboard.readText().then((o=>{this.continuePaste(e,t,r,o,n)}));else{var o=n.toString();this.continuePaste(e,t,r,o,n)}},continuePaste:function(e,r,n,o,i){var a=copyCursor(e.getCursor());if(o){if(r.matchIndent){var s=e.getOption("tabSize");var whitespaceLength=function(/** @type {string} */e){var t=e.split("\t").length-1;var r=e.split(" ").length-1;return t*s+r*1};var l=e.getLine(e.getCursor().line);var c=whitespaceLength(l.match(/^\s*/)[0]);var u=o.replace(/\n$/,"");var h=o!==u;var f=whitespaceLength(o.match(/^\s*/)[0]);o=u.replace(/^\s*/gm,(function(t){var r=c+(whitespaceLength(t)-f);if(r<0)return"";if(e.getOption("indentWithTabs")){var n=Math.floor(r/s);return Array(n+1).join("\t")}return Array(r+1).join(" ")}));o+=h?"\n":""}if(r.repeat>1)o=Array(r.repeat+1).join(o);var d=i.linewise;var m=i.blockwise;if(m){o=o.split("\n");d&&o.pop();for(var v=0;v<o.length;v++)o[v]=o[v]==""?" ":o[v];a.ch+=r.after?1:0;a.ch=Math.min(lineLength(e,a.line),a.ch)}else if(d)if(n.visualMode)o=n.visualLine?o.slice(0,-1):"\n"+o.slice(0,o.length-1)+"\n";else if(r.after){o="\n"+o.slice(0,o.length-1);a.ch=lineLength(e,a.line)}else a.ch=0;else a.ch+=r.after?1:0;var g;if(n.visualMode){n.lastPastedText=o;var y;var C=getSelectedAreaRange(e,n);var w=C[0];var S=C[1];var k=e.getSelection();var x=e.listSelections();var M=new Array(x.length).join("1").split("1");n.lastSelection&&(y=n.lastSelection.headMark.find());p.registerController.unnamedRegister.setText(k);if(m){e.replaceSelections(M);S=new t(w.line+o.length-1,w.ch);e.setCursor(w);selectBlock(e,S);e.replaceSelections(o);g=w}else if(n.visualBlock){e.replaceSelections(M);e.setCursor(w);e.replaceRange(o,w,w);g=w}else{e.replaceRange(o,w,S);g=e.posFromIndex(e.indexFromPos(w)+o.length-1)}y&&(n.lastSelection.headMark=e.setBookmark(y));d&&(g.ch=0)}else if(m){e.setCursor(a);for(v=0;v<o.length;v++){var L=a.line+v;L>e.lastLine()&&e.replaceRange("\n",new t(L,0));var b=lineLength(e,L);b<a.ch&&extendLineToColumn(e,L,a.ch)}e.setCursor(a);selectBlock(e,new t(a.line+o.length-1,a.ch));e.replaceSelections(o);g=a}else{e.replaceRange(o,a);if(d){L=r.after?a.line+1:a.line;g=new t(L,findFirstNonWhiteSpaceCharacter(e.getLine(L)))}else{g=copyCursor(a);/\n/.test(o)||(g.ch+=o.length-(r.after?1:0))}}n.visualMode&&exitVisualMode(e,false);e.setCursor(g)}},undo:function(t,r){t.operation((function(){repeatFn(t,e.commands.undo,r.repeat)();t.setCursor(clipCursorToContent(t,t.getCursor("start")))}))},redo:function(t,r){repeatFn(t,e.commands.redo,r.repeat)()},setRegister:function(e,t,r){r.inputState.registerName=t.selectedCharacter},insertRegister:function(e,t,r){var n=t.selectedCharacter;var o=p.registerController.getRegister(n);var i=o&&o.toString();i&&e.replaceSelection(i)},oneNormalCommand:function(t,r,n){exitInsertMode(t,true);n.insertModeReturn=true;e.on(t,"vim-command-done",(function handler(){if(!n.visualMode){if(n.insertModeReturn){n.insertModeReturn=false;n.insertMode||b.enterInsertMode(t,{},n)}e.off(t,"vim-command-done",handler)}}))},setMark:function(e,t,r){var n=t.selectedCharacter;n&&updateMark(e,r,n,e.getCursor())},replace:function(r,n,o){var i=n.selectedCharacter||"";var a=r.getCursor();var s;var l;var c=r.listSelections();if(o.visualMode){a=r.getCursor("start");l=r.getCursor("end")}else{var u=r.getLine(a.line);s=a.ch+n.repeat;s>u.length&&(s=u.length);l=new t(a.line,s)}var h=updateSelectionForSurrogateCharacters(r,a,l);a=h.start;l=h.end;if(i=="\n"){o.visualMode||r.replaceRange("",a,l);(e.commands.newlineAndIndentContinueComment||e.commands.newlineAndIndent)(r)}else{var f=r.getRange(a,l);f=f.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,i);f=f.replace(/[^\n]/g,i);if(o.visualBlock){var d=new Array(r.getOption("tabSize")+1).join(" ");f=r.getSelection();f=f.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,i);var p=f.replace(/\t/g,d).replace(/[^\n]/g,i).split("\n");r.replaceSelections(p)}else r.replaceRange(f,a,l);if(o.visualMode){a=cursorIsBefore(c[0].anchor,c[0].head)?c[0].anchor:c[0].head;r.setCursor(a);exitVisualMode(r,false)}else r.setCursor(offsetCursor(l,0,-1))}},incrementNumberToken:function(e,r){var n=e.getCursor();var o=e.getLine(n.line);var i=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi;var a;var s;var l;var c;while((a=i.exec(o))!==null){s=a.index;l=s+a[0].length;if(n.ch<l)break}if((r.backtrack||!(l<=n.ch))&&a){var u=a[2]||a[4];var h=a[3]||a[5];var f=r.increase?1:-1;var d={"0b":2,0:8,"":10,"0x":16}[u.toLowerCase()];var p=parseInt(a[1]+h,d)+f*r.repeat;c=p.toString(d);var m=u?new Array(h.length-c.length+1+a[1].length).join("0"):"";c=c.charAt(0)==="-"?"-"+u+m+c.substr(1):u+m+c;var v=new t(n.line,s);var g=new t(n.line,l);e.replaceRange(c,v,g);e.setCursor(new t(n.line,s+c.length-1))}},repeatLastEdit:function(e,t,r){var n=r.lastEditInputState;if(n){var o=t.repeat;o&&t.repeatIsExplicit?n.repeatOverride=o:o=n.repeatOverride||o;repeatLastEdit(e,r,o,false)}},indent:function(e,t){e.indentLine(e.getCursor().line,t.indentRight)},exitInsertMode:function(e,t){exitInsertMode(e)}};function defineAction(e,t){b[e]=t}function clipCursorToContent(e,r,n){var o=e.state.vim;var i=o.insertMode||o.visualMode;var a=Math.min(Math.max(e.firstLine(),r.line),e.lastLine());var s=e.getLine(a);var l=s.length-1+Number(!!i);var c=Math.min(Math.max(0,r.ch),l);var u=s.charCodeAt(c);if(56320<=u&&u<=57343){var h=1;n&&n.line==a&&n.ch>c&&(h=-1);c+=h;c>l&&(c-=2)}return new t(a,c)}function copyArgs(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function offsetCursor(e,r,n){if(typeof r==="object"){n=r.ch;r=r.line}return new t(e.line+r,e.ch+n)}function commandMatches(e,t,r,o){o.operator&&(r="operatorPending");var i,a=[],s=[];var l=y?t.length-n:0;for(var c=l;c<t.length;c++){var u=t[c];if(!(r=="insert"&&u.context!="insert"||u.context&&u.context!=r||o.operator&&u.type=="action")&&(i=commandMatch(e,u.keys))){i=="partial"&&a.push(u);i=="full"&&s.push(u)}}return{partial:a.length&&a,full:s.length&&s}}function commandMatch(e,t){const r=t.slice(-11)=="<character>";const n=t.slice(-10)=="<register>";if(r||n){var o=t.length-(r?11:10);var i=e.slice(0,o);var a=t.slice(0,o);return i==a&&e.length>o?"full":a.indexOf(i)==0&&"partial"}return e==t?"full":t.indexOf(e)==0&&"partial"}function lastChar(e){var t=/^.*(<[^>]+>)$/.exec(e);var r=t?t[1]:e.slice(-1);if(r.length>1)switch(r){case"<CR>":case"<S-CR>":r="\n";break;case"<Space>":case"<S-Space>":r=" ";break;default:r="";break}return r}function repeatFn(e,t,r){return function(){for(var n=0;n<r;n++)t(e)}}function copyCursor(e){return new t(e.line,e.ch)}function cursorEqual(e,t){return e.ch==t.ch&&e.line==t.line}function cursorIsBefore(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function cursorMin(e,t){arguments.length>2&&(t=cursorMin.apply(void 0,Array.prototype.slice.call(arguments,1)));return cursorIsBefore(e,t)?e:t}function cursorMax(e,t){arguments.length>2&&(t=cursorMax.apply(void 0,Array.prototype.slice.call(arguments,1)));return cursorIsBefore(e,t)?t:e}function cursorIsBetween(e,t,r){var n=cursorIsBefore(e,t);var o=cursorIsBefore(t,r);return n&&o}function lineLength(e,t){return e.getLine(t).length}function trim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function escapeRegex(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function extendLineToColumn(e,r,n){var o=lineLength(e,r);var i=new Array(n-o+1).join(" ");e.setCursor(new t(r,o));e.replaceRange(i,e.getCursor())}function selectBlock(e,r){var n=[],o=e.listSelections();var i=copyCursor(e.clipPos(r));var a=!cursorEqual(r,i);var s=e.getCursor("head");var l=getIndex(o,s);var c=cursorEqual(o[l].head,o[l].anchor);var u=o.length-1;var h=u-l>l?u:0;var f=o[h].anchor;var d=Math.min(f.line,i.line);var p=Math.max(f.line,i.line);var m=f.ch,v=i.ch;var g=o[h].head.ch-m;var y=v-m;if(g>0&&y<=0){m++;a||v--}else if(g<0&&y>=0){m--;c||v++}else if(g<0&&y==-1){m--;v++}for(var C=d;C<=p;C++){var w={anchor:new t(C,m),head:new t(C,v)};n.push(w)}e.setSelections(n);r.ch=v;f.ch=m;return f}function selectForInsert(e,t,r){var n=[];for(var o=0;o<r;o++){var i=offsetCursor(t,o,0);n.push({anchor:i,head:i})}e.setSelections(n,0)}function getIndex(e,t,r){for(var n=0;n<e.length;n++){var o=r!="head"&&cursorEqual(e[n].anchor,t);var i=r!="anchor"&&cursorEqual(e[n].head,t);if(o||i)return n}return-1}function getSelectedAreaRange(e,r){var n=r.lastSelection;var getCurrentSelectedAreaRange=function(){var t=e.listSelections();var r=t[0];var n=t[t.length-1];var o=cursorIsBefore(r.anchor,r.head)?r.anchor:r.head;var i=cursorIsBefore(n.anchor,n.head)?n.head:n.anchor;return[o,i]};var getLastSelectedAreaRange=function(){var r=e.getCursor();var o=e.getCursor();var i=n.visualBlock;if(i){var a=i.width;var s=i.height;o=new t(r.line+s,r.ch+a);var l=[];for(var c=r.line;c<o.line;c++){var u=new t(c,r.ch);var h=new t(c,o.ch);var f={anchor:u,head:h};l.push(f)}e.setSelections(l)}else{var d=n.anchorMark.find();var p=n.headMark.find();var m=p.line-d.line;var v=p.ch-d.ch;o={line:o.line+m,ch:m?o.ch:v+o.ch};if(n.visualLine){r=new t(r.line,0);o=new t(o.line,lineLength(e,o.line))}e.setSelection(r,o)}return[r,o]};return r.visualMode?getCurrentSelectedAreaRange():getLastSelectedAreaRange()}function updateLastSelection(e,t){var r=t.sel.anchor;var n=t.sel.head;if(t.lastPastedText){n=e.posFromIndex(e.indexFromPos(r)+t.lastPastedText.length);t.lastPastedText=null}t.lastSelection={anchorMark:e.setBookmark(r),headMark:e.setBookmark(n),anchor:copyCursor(r),head:copyCursor(n),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}
/** @arg {CodeMirrorV} cm @arg {Pos} start @arg {Pos} end @returns {[Pos, Pos]} */function expandSelection(e,r,n,o){var i=e.state.vim.sel;var a=o?r:i.head;var s=o?r:i.anchor;var l;if(cursorIsBefore(n,r)){l=n;n=r;r=l}if(cursorIsBefore(a,s)){a=cursorMin(r,a);s=cursorMax(s,n)}else{s=cursorMin(r,s);a=cursorMax(a,n);a=offsetCursor(a,0,-1);a.ch==-1&&a.line!=e.firstLine()&&(a=new t(a.line-1,lineLength(e,a.line-1)))}return[s,a]}function updateCmSelection(e,t,r){var n=e.state.vim;t=t||n.sel;r||(r=n.visualLine?"line":n.visualBlock?"block":"char");var o=makeCmSelection(e,t,r);e.setSelections(o.ranges,o.primary)}function makeCmSelection(e,r,n,o){var i=copyCursor(r.head);var a=copyCursor(r.anchor);if(n=="char"){var s=o||cursorIsBefore(r.head,r.anchor)?0:1;var l=cursorIsBefore(r.head,r.anchor)?1:0;i=offsetCursor(r.head,0,s);a=offsetCursor(r.anchor,0,l);return{ranges:[{anchor:a,head:i}],primary:0}}if(n=="line"){if(cursorIsBefore(r.head,r.anchor)){i.ch=0;a.ch=lineLength(e,a.line)}else{a.ch=0;var c=e.lastLine();i.line>c&&(i.line=c);i.ch=lineLength(e,i.line)}return{ranges:[{anchor:a,head:i}],primary:0}}if(n=="block"){var u=Math.min(a.line,i.line),h=a.ch,f=Math.max(a.line,i.line),d=i.ch;h<d?d+=1:h+=1;var p=f-u+1;var m=i.line==u?0:p-1;var v=[];for(var g=0;g<p;g++)v.push({anchor:new t(u+g,h),head:new t(u+g,d)});return{ranges:v,primary:m}}throw"never happens"}function getHead(e){var t=e.getCursor("head");e.getSelection().length==1&&(t=cursorMin(t,e.getCursor("anchor")));return t}function exitVisualMode(t,r){var n=t.state.vim;r!==false&&t.setCursor(clipCursorToContent(t,n.sel.head));updateLastSelection(t,n);n.visualMode=false;n.visualLine=false;n.visualBlock=false;n.insertMode||e.signal(t,"vim-mode-change",{mode:"normal"})}function clipToLine(e,t,r){var n=e.getRange(t,r);if(/\n\s*$/.test(n)){var o=n.split("\n");o.pop();for(var i=o.pop();o.length>0&&i&&isWhiteSpaceString(i);i=o.pop()){r.line--;r.ch=0}if(i){r.line--;r.ch=lineLength(e,r.line)}else r.ch=0}}function expandSelectionToLine(e,t,r){t.ch=0;r.ch=0;r.line++}function findFirstNonWhiteSpaceCharacter(e){if(!e)return 0;var t=e.search(/\S/);return t==-1?e.length:t}function expandWordUnderCursor(e,{inclusive:r,innerWord:n,bigWord:o,noSymbol:i,multiline:a},c){var u=c||getHead(e);var h=e.getLine(u.line);var f=h;var d=u.line;var p=d;var m=u.ch;var v;var g=i?s[0]:l[0];if(n&&/\s/.test(h.charAt(m)))g=function(/** @type {string} */e){return/\s/.test(e)};else{while(!g(h.charAt(m))){m++;if(m>=h.length){if(!a)return null;m--;v=findWord(e,u,true,o,true);break}}if(o)g=l[0];else{g=s[0];g(h.charAt(m))||(g=s[1])}}var y=m,C=m;while(g(h.charAt(C))&&C>=0)C--;C++;if(v){y=v.to;p=v.line;f=e.getLine(p);f||y!=0||y++}else while(g(h.charAt(y))&&y<h.length)y++;if(r){var w=y;var S=u.ch<=C&&/\s/.test(h.charAt(u.ch));if(!S)while(/\s/.test(f.charAt(y))&&y<f.length)y++;if(w==y||S){var k=C;while(/\s/.test(h.charAt(C-1))&&C>0)C--;C||S||(C=k)}}return{start:new t(d,C),end:new t(p,y)}}function expandTagUnderCursor(t,r,n){var o=r;if(!e.findMatchingTag||!e.findEnclosingTag)return{start:o,end:o};var i=e.findMatchingTag(t,r)||e.findEnclosingTag(t,r);return i&&i.open&&i.close?n?{start:i.open.from,end:i.close.to}:{start:i.open.to,end:i.close.from}:{start:o,end:o}}function recordJumpPosition(e,t,r){cursorEqual(t,r)||p.jumpList.add(e,t,r)}function recordLastCharacterSearch(e,t){p.lastCharacterSearch.increment=e;p.lastCharacterSearch.forward=t.forward;p.lastCharacterSearch.selectedCharacter=t.selectedCharacter}var A={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"};var E={bracket:{isComplete:function(e){if(e.nextCh===e.symb){e.depth++;if(e.depth>=1)return true}else e.nextCh===e.reverseSymb&&e.depth--;return false}},section:{init:function(e){e.curMoveThrough=true;e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return e.index===0&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t=e.lastCh==="*"&&e.nextCh==="/";e.lastCh=e.nextCh;return t}},method:{init:function(e){e.symb=e.symb==="m"?"{":"}";e.reverseSymb=e.symb==="{"?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if(e.nextCh==="#"){var t=e.lineText.match(/^#(\w+)/)[1];if(t==="endif"){if(e.forward&&e.depth===0)return true;e.depth++}else if(t==="if"){if(!e.forward&&e.depth===0)return true;e.depth--}if(t==="else"&&e.depth===0)return true}return false}}};function findSymbol(e,r,n,o){var i=copyCursor(e.getCursor());var a=n?1:-1;var s=n?e.lineCount():-1;var l=i.ch;var c=i.line;var u=e.getLine(c);var h={lineText:u,nextCh:u.charAt(l),lastCh:null,index:l,symb:o,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[o],forward:n,depth:0,curMoveThrough:false};var f=A[o];if(!f)return i;var d=E[f].init;var p=E[f].isComplete;d&&d(h);while(c!==s&&r){h.index+=a;h.nextCh=h.lineText.charAt(h.index);if(!h.nextCh){c+=a;h.lineText=e.getLine(c)||"";if(a>0)h.index=0;else{var m=h.lineText.length;h.index=m>0?m-1:0}h.nextCh=h.lineText.charAt(h.index)}if(p(h)){i.line=c;i.ch=h.index;r--}}return h.nextCh||h.curMoveThrough?new t(c,h.index):i}function findWord(e,t,r,n,o){var i=t.line;var a=t.ch;var c=e.getLine(i);var u=r?1:-1;var h=n?l:s;if(o&&c==""){i+=u;c=e.getLine(i);if(!isLine(e,i))return null;a=r?0:c.length}while(true){if(o&&c=="")return{from:0,to:0,line:i};var f=u>0?c.length:-1;var d=f,p=f;while(a!=f){var m=false;for(var v=0;v<h.length&&!m;++v)if(h[v](c.charAt(a))){d=a;while(a!=f&&h[v](c.charAt(a)))a+=u;p=a;m=d!=p;if(d==t.ch&&i==t.line&&p==d+u)continue;return{from:Math.min(d,p+1),to:Math.max(d,p),line:i}}m||(a+=u)}i+=u;if(!isLine(e,i))return null;c=e.getLine(i);a=u>0?0:c.length}}function moveToWord(e,r,n,o,i,a){var s=copyCursor(r);var l=[];(o&&!i||!o&&i)&&n++;var c=!(o&&i);for(var u=0;u<n;u++){var h=findWord(e,r,o,a,c);if(!h){var f=lineLength(e,e.lastLine());l.push(o?{line:e.lastLine(),from:f,to:f}:{line:0,from:0,to:0});break}l.push(h);r=new t(h.line,o?h.to-1:h.from)}var d=l.length!=n;var p=l[0];var m=l.pop();if(o&&!i){d||p.from==s.ch&&p.line==s.line||(m=l.pop());return m&&new t(m.line,m.from)}if(o&&i)return m&&new t(m.line,m.to-1);if(!o&&i){d||p.to==s.ch&&p.line==s.line||(m=l.pop());return m&&new t(m.line,m.to)}return m&&new t(m.line,m.from)}function moveToEol(e,r,n,o,i){var a=r;var s=new t(a.line+n.repeat-1,Infinity);var l=e.clipPos(s);l.ch--;if(!i){o.lastHPos=Infinity;o.lastHSPos=e.charCoords(l,"div").left}return s}function moveToCharacter(e,r,n,o,i){if(o){var a=i||e.getCursor();var s=a.ch;var l;for(var c=0;c<r;c++){var u=e.getLine(a.line);l=charIdxInLine(s,u,o,n,true);if(l==-1)return;s=l}return l!=void 0?new t(e.getCursor().line,l):void 0}}function moveToColumn(e,r){var n=e.getCursor().line;return clipCursorToContent(e,new t(n,r-1))}function updateMark(e,t,r,n){if(inArray(r,c)||h.test(r)){t.marks[r]&&t.marks[r].clear();t.marks[r]=e.setBookmark(n)}}function charIdxInLine(e,t,r,n,o){var i;if(n){i=t.indexOf(r,e+1);i==-1||o||(i-=1)}else{i=t.lastIndexOf(r,e-1);i==-1||o||(i+=1)}return i}function findParagraph(e,r,n,o,i){var a=r.line;var s=e.firstLine();var l=e.lastLine();var c,u,h=a;function isEmpty(t){return!e.getLine(t)}function isBoundary(e,t,r){return r?isEmpty(e)!=isEmpty(e+t):!isEmpty(e)&&isEmpty(e+t)}if(o){while(s<=h&&h<=l&&n>0){isBoundary(h,o)&&n--;h+=o}return{start:new t(h,0),end:r}}var f=e.state.vim;if(f.visualLine&&isBoundary(a,1,true)){var d=f.sel.anchor;isBoundary(d.line,-1,true)&&(i&&d.line==a||(a+=1))}var p=isEmpty(a);for(h=a;h<=l&&n;h++)isBoundary(h,1,true)&&(i&&isEmpty(h)==p||n--);u=new t(h,0);h>l&&!p?p=true:i=false;for(h=a;h>s;h--)if((!i||isEmpty(h)==p||h==a)&&isBoundary(h,-1,true))break;c=new t(h,0);return{start:c,end:u}}function getSentence(e,r,n,o,i){function nextChar(e){e.pos+e.dir<0||e.pos+e.dir>=e.line.length?e.line=null:e.pos+=e.dir}function forward(e,t,r,n){var o=e.getLine(t);var a={line:o,ln:t,pos:r,dir:n};if(a.line==="")return{ln:a.ln,pos:a.pos};var s=a.pos;nextChar(a);while(a.line!==null){s=a.pos;if(isEndOfSentenceSymbol(a.line[a.pos])){if(i){nextChar(a);while(a.line!==null){if(!isWhiteSpaceString(a.line[a.pos]))break;s=a.pos;nextChar(a)}return{ln:a.ln,pos:s+1}}return{ln:a.ln,pos:a.pos+1}}nextChar(a)}return{ln:a.ln,pos:s+1}}function reverse(e,t,r,n){var o=e.getLine(t);var a={line:o,ln:t,pos:r,dir:n};if(a.line==="")return{ln:a.ln,pos:a.pos};var s=a.pos;nextChar(a);while(a.line!==null){if(isWhiteSpaceString(a.line[a.pos])||isEndOfSentenceSymbol(a.line[a.pos])){if(isEndOfSentenceSymbol(a.line[a.pos]))return i&&isWhiteSpaceString(a.line[a.pos+1])?{ln:a.ln,pos:a.pos+1}:{ln:a.ln,pos:s}}else s=a.pos;nextChar(a)}a.line=o;return i&&isWhiteSpaceString(a.line[a.pos])?{ln:a.ln,pos:a.pos}:{ln:a.ln,pos:s}}var a={ln:r.line,pos:r.ch};while(n>0){a=o<0?reverse(e,a.ln,a.pos,o):forward(e,a.ln,a.pos,o);n--}return new t(a.ln,a.pos)}function findSentence(e,r,n,o){function nextChar(e,t){if(t.pos+t.dir<0||t.pos+t.dir>=t.line.length){t.ln+=t.dir;if(!isLine(e,t.ln)){t.line=null;t.ln=null;t.pos=null;return}t.line=e.getLine(t.ln);t.pos=t.dir>0?0:t.line.length-1}else t.pos+=t.dir}function forward(e,t,r,n){var o=e.getLine(t);var i=o==="";var a={line:o,ln:t,pos:r,dir:n};var s={ln:a.ln,pos:a.pos};var l=a.line==="";nextChar(e,a);while(a.line!==null){s.ln=a.ln;s.pos=a.pos;if(a.line===""&&!l)return{ln:a.ln,pos:a.pos};if(i&&a.line!==""&&!isWhiteSpaceString(a.line[a.pos]))return{ln:a.ln,pos:a.pos};!isEndOfSentenceSymbol(a.line[a.pos])||i||a.pos!==a.line.length-1&&!isWhiteSpaceString(a.line[a.pos+1])||(i=true);nextChar(e,a)}o=e.getLine(s.ln);s.pos=0;for(var c=o.length-1;c>=0;--c)if(!isWhiteSpaceString(o[c])){s.pos=c;break}return s}function reverse(e,t,r,n){var o=e.getLine(t);var i={line:o,ln:t,pos:r,dir:n};
/** @type {{ln: number, pos: number|null}} */var a={ln:i.ln,pos:null};var s=i.line==="";nextChar(e,i);while(i.line!==null){if(i.line===""&&!s)return a.pos!==null?a:{ln:i.ln,pos:i.pos};if(isEndOfSentenceSymbol(i.line[i.pos])&&a.pos!==null&&(i.ln!==a.ln||i.pos+1!==a.pos))return a;if(i.line!==""&&!isWhiteSpaceString(i.line[i.pos])){s=false;a={ln:i.ln,pos:i.pos}}nextChar(e,i)}o=e.getLine(a.ln);a.pos=0;for(var l=0;l<o.length;++l)if(!isWhiteSpaceString(o[l])){a.pos=l;break}return a}var i={ln:r.line,pos:r.ch};while(n>0){i=o<0?reverse(e,i.ln,i.pos,o):forward(e,i.ln,i.pos,o);n--}return new t(i.ln,i.pos)}function selectCompanionObject(e,r,n,o){var i=r;var a={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[n];var s={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[n];var l=e.getLine(i.line).charAt(i.ch);var c=l===s?1:0;var u=e.scanForBracket(new t(i.line,i.ch+c),-1,void 0,{bracketRegex:a});var h=e.scanForBracket(new t(i.line,i.ch+c),1,void 0,{bracketRegex:a});if(!u||!h)return null;var f=u.pos;var d=h.pos;if(f.line==d.line&&f.ch>d.ch||f.line>d.line){var p=f;f=d;d=p}o?d.ch+=1:f.ch+=1;return{start:f,end:d}}function findBeginningAndEnd(e,r,n,o){var i=copyCursor(r);var a=e.getLine(i.line);var s=a.split("");var l,c,u,h;var f=s.indexOf(n);if(i.ch<f)i.ch=f;else if(f<i.ch&&s[i.ch]==n){var d=/string/.test(e.getTokenTypeAt(offsetCursor(r,0,1)));var p=/string/.test(e.getTokenTypeAt(r));var m=d&&!p;if(!m){c=i.ch;--i.ch}}if(s[i.ch]!=n||c)for(u=i.ch;u>-1&&!l;u--)s[u]==n&&(l=u+1);else l=i.ch+1;if(l&&!c)for(u=l,h=s.length;u<h&&!c;u++)s[u]==n&&(c=u);if(!l||!c)return{start:i,end:i};if(o){--l;++c}return{start:new t(i.line,l),end:new t(i.line,c)}}defineOption("pcre",true,"boolean");class SearchState{getQuery(){return p.query}setQuery(e){p.query=e}getOverlay(){return this.searchOverlay}setOverlay(e){this.searchOverlay=e}isReversed(){return p.isReversed}setReversed(e){p.isReversed=e}getScrollbarAnnotate(){return this.annotate}setScrollbarAnnotate(e){this.annotate=e}}function getSearchState(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new SearchState)}function splitBySlash(e){return splitBySeparator(e,"/")}function findUnescapedSlashes(e){return findUnescapedSeparators(e,"/")}function splitBySeparator(e,t){var r=findUnescapedSeparators(e,t)||[];if(!r.length)return[];var n=[];if(r[0]===0){for(var o=0;o<r.length;o++)typeof r[o]=="number"&&n.push(e.substring(r[o]+1,r[o+1]));return n}}function findUnescapedSeparators(e,t){t||(t="/");var r=false;var n=[];for(var o=0;o<e.length;o++){var i=e.charAt(o);r||i!=t||n.push(o);r=!r&&i=="\\"}return n}function translateRegex(e){var t="|(){";var r="}";var n=false;var o=[];for(var i=-1;i<e.length;i++){var a=e.charAt(i)||"";var s=e.charAt(i+1)||"";var l=s&&t.indexOf(s)!=-1;if(n){a==="\\"&&l||o.push(a);n=false}else if(a==="\\"){n=true;s&&r.indexOf(s)!=-1&&(l=true);l&&s!=="\\"||o.push(a)}else{o.push(a);l&&s!=="\\"&&o.push("\\")}}return o.join("")}
/** @type{Object<string, string>} */var T={"\\n":"\n","\\r":"\r","\\t":"\t"};function translateRegexReplace(e){var t=false;var r=[];for(var n=-1;n<e.length;n++){var o=e.charAt(n)||"";var i=e.charAt(n+1)||"";if(T[o+i]){r.push(T[o+i]);n++}else if(t){r.push(o);t=false}else if(o==="\\"){t=true;isNumber(i)||i==="$"?r.push("$"):i!=="/"&&i!=="\\"&&r.push("\\")}else{o==="$"&&r.push("$");r.push(o);i==="/"&&r.push("\\")}}return r.join("")}
/** @type{Record<string, string>} */var O={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"};function unescapeRegexReplace(t){var r=new e.StringStream(t);var n=[];while(!r.eol()){while(r.peek()&&r.peek()!="\\")n.push(r.next());var o=false;for(var i in O)if(r.match(i,true)){o=true;n.push(O[i]);break}o||n.push(r.next())}return n.join("")}function parseQuery(e,t,r){var n=p.registerController.getRegister("/");n.setText(e);if(e instanceof RegExp)return e;var o=findUnescapedSlashes(e);var i;var a;if(o.length){i=e.substring(0,o[0]);var s=e.substring(o[0]);a=s.indexOf("i")!=-1}else i=e;if(!i)return null;getOption("pcre")||(i=translateRegex(i));r&&(t=/^[^A-Z]*$/.test(i));var l=new RegExp(i,t||a?"im":"m");return l}function dom(e){typeof e==="string"&&(e=document.createElement(e));for(var t,r=1;r<arguments.length;r++)if(t=arguments[r]){typeof t!=="object"&&(t=document.createTextNode(t));if(t.nodeType)e.appendChild(t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(n[0]==="$"?e.style[n.slice(1)]=t[n]:e.setAttribute(n,t[n]))}return e}function showConfirm(e,t){var r=dom("div",{$color:"red",$whiteSpace:"pre",class:"cm-vim-message"},t);e.openNotification?e.openNotification(r,{bottom:true,duration:5e3}):alert(r.innerText)}function makePrompt(e,t){return dom("div",{$display:"flex"},dom("span",{$fontFamily:"monospace",$whiteSpace:"pre",$flex:1},e,dom("input",{type:"text",autocorrect:"off",autocapitalize:"off",spellcheck:"false",$width:"100%"})),t&&dom("span",{$color:"#888"},t))}function showPrompt(e,t){if(g.length){t.value||(t.value="");C=t}else{var r=makePrompt(t.prefix,t.desc);if(e.openDialog)e.openDialog(r,t.onClose,{onKeyDown:t.onKeyDown,onKeyUp:t.onKeyUp,bottom:true,selectValueOnOpen:false,value:t.value});else{var n="";typeof t.prefix!="string"&&t.prefix&&(n+=t.prefix.textContent);t.desc&&(n+=" "+t.desc);t.onClose(prompt(n,""))}}}function regexEqual(e,t){if(e instanceof RegExp&&t instanceof RegExp){var r=["global","multiline","ignoreCase","source"];for(var n=0;n<r.length;n++){var o=r[n];if(e[o]!==t[o])return false}return true}return false}function updateSearchQuery(e,t,r,n){if(t){var o=getSearchState(e);var i=parseQuery(t,!!r,!!n);if(i){highlightSearchMatches(e,i);if(regexEqual(i,o.getQuery()))return i;o.setQuery(i);return i}}}function searchOverlay(e){if(e.source.charAt(0)=="^")var t=true;return{token:function(r){if(!t||r.sol()){var n=r.match(e,false);if(n){if(n[0].length==0){r.next();return"searching"}if(!r.sol()){r.backUp(1);if(!e.exec(r.next()+n[0])){r.next();return null}}r.match(e);return"searching"}while(!r.eol()){r.next();if(r.match(e,false))break}}else r.skipToEnd()},query:e}}var I=0;function highlightSearchMatches(e,t){clearTimeout(I);var r=getSearchState(e);r.highlightTimeout=I;I=setTimeout((function(){if(e.state.vim){var r=getSearchState(e);r.highlightTimeout=null;var n=r.getOverlay();if(!n||t!=n.query){n&&e.removeOverlay(n);n=searchOverlay(t);e.addOverlay(n);if(e.showMatchesOnScrollbar){r.getScrollbarAnnotate()&&r.getScrollbarAnnotate().clear();r.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))}r.setOverlay(n)}}}),50)}function findNext(e,r,n,o){return e.operation((function(){o===void 0&&(o=1);var i=e.getCursor();var a=e.getSearchCursor(n,i);for(var s=0;s<o;s++){var l=a.find(r);if(s==0&&l&&cursorEqual(a.from(),i)){var c=r?a.from():a.to();l=a.find(r);l&&!l[0]&&cursorEqual(a.from(),c)&&e.getLine(c.line).length==c.ch&&(l=a.find(r))}if(!l){a=e.getSearchCursor(n,r?new t(e.lastLine()):new t(e.firstLine(),0));if(!a.find(r))return}}return a.from()}))}function findNextFromAndToInclusive(e,r,n,o,i){return e.operation((function(){o===void 0&&(o=1);var a=e.getCursor();var s=e.getSearchCursor(n,a);var l=s.find(!r);!i.visualMode&&l&&cursorEqual(s.from(),a)&&s.find(!r);for(var c=0;c<o;c++){l=s.find(r);if(!l){s=e.getSearchCursor(n,r?new t(e.lastLine()):new t(e.firstLine(),0));if(!s.find(r))return}}return[s.from(),s.to()]}))}function clearSearchHighlight(e){var t=getSearchState(e);if(t.highlightTimeout){clearTimeout(t.highlightTimeout);t.highlightTimeout=null}e.removeOverlay(getSearchState(e).getOverlay());t.setOverlay(null);if(t.getScrollbarAnnotate()){t.getScrollbarAnnotate().clear();t.setScrollbarAnnotate(null)}}function isInRange(e,t,r){typeof e!="number"&&(e=e.line);return t instanceof Array?inArray(e,t):typeof r=="number"?e>=t&&e<=r:e==t}function getUserVisibleLines(e){var t=e.getScrollInfo();var r=6;var n=10;var o=e.coordsChar({left:0,top:r+t.top},"local");var i=t.clientHeight-n+t.top;var a=e.coordsChar({left:0,top:i},"local");return{top:o.line,bottom:a.line}}function getMarkPos(e,r,n){if(n=="'"||n=="`")return p.jumpList.find(e,-1)||new t(0,0);if(n==".")return getLastEditPos(e);var o=r.marks[n];return o&&o.find()}function getLastEditPos(e){if(e.getLastEditEnd)return e.getLastEditEnd();var t=/**@type{any}*/e.doc.history.done;for(var r=t.length;r--;)if(t[r].changes)return copyCursor(t[r].changes[0].to)}class ExCommandDispatcher{constructor(){
/**@type {Record<string, any>} */
this.commandMap_;this.buildCommandMap_()}processCommand(e,t,r){var n=this;e.operation((function(){e.curOp.isVimOp=true;n._processCommand(e,t,r)}))}_processCommand(t,r,n){var o=t.state.vim;var i=p.registerController.getRegister(":");var a=i.toString();var s=new e.StringStream(r);i.setText(r);var l=n||{};l.input=r;try{this.parseInput_(t,s,l)}catch(e){showConfirm(t,e+"");throw e}o.visualMode&&exitVisualMode(t);var c;var u;if(l.commandName){c=this.matchCommand_(l.commandName);if(c){u=c.name;c.excludeFromCommandHistory&&i.setText(a);this.parseCommandArgs_(s,l,c);if(c.type=="exToKey"){doKeyToKey(t,c.toKeys,c);return}if(c.type=="exToEx"){this.processCommand(t,c.toInput);return}}}else l.line!==void 0&&(u="move");if(u)try{R[u](t,l);c&&c.possiblyAsync||!l.callback||l.callback()}catch(e){showConfirm(t,e+"");throw e}else showConfirm(t,'Not an editor command ":'+r+'"')}parseInput_(e,t,r){t.eatWhile(":");if(t.eat("%")){r.line=e.firstLine();r.lineEnd=e.lastLine()}else{r.line=this.parseLineSpec_(e,t);r.line!==void 0&&t.eat(",")&&(r.lineEnd=this.parseLineSpec_(e,t))}if(r.line==void 0)if(e.state.vim.visualMode){r.selectionLine=getMarkPos(e,e.state.vim,"<")?.line;r.selectionLineEnd=getMarkPos(e,e.state.vim,">")?.line}else r.selectionLine=e.getCursor().line;else{r.selectionLine=r.line;r.selectionLineEnd=r.lineEnd}var n=t.match(/^(\w+|!!|@@|[!#&*<=>@~])/);r.commandName=n?n[1]:t.match(/.*/)[0];return r}parseLineSpec_(e,t){var r=t.match(/^(\d+)/);if(r)return parseInt(r[1],10)-1;switch(t.next()){case".":return this.parseLineSpecOffset_(t,e.getCursor().line);case"$":return this.parseLineSpecOffset_(t,e.lastLine());case"'":var n=t.next();var o=getMarkPos(e,e.state.vim,n);if(!o)throw new Error("Mark not set");return this.parseLineSpecOffset_(t,o.line);case"-":case"+":t.backUp(1);return this.parseLineSpecOffset_(t,e.getCursor().line);default:t.backUp(1);return}}parseLineSpecOffset_(e,t){var r=e.match(/^([+-])?(\d+)/);if(r){var n=parseInt(r[2],10);r[1]=="-"?t-=n:t+=n}return t}parseCommandArgs_(e,t,r){if(!e.eol()){t.argString=e.match(/.*/)[0];var n=r.argDelimiter||/\s+/;var o=trim(t.argString).split(n);o.length&&o[0]&&(t.args=o)}}matchCommand_(e){for(var t=e.length;t>0;t--){var r=e.substring(0,t);if(this.commandMap_[r]){var n=this.commandMap_[r];if(n.name.indexOf(e)===0)return n}}return null}buildCommandMap_(){this.commandMap_={};for(var e=0;e<o.length;e++){var t=o[e];var r=t.shortName||t.name;this.commandMap_[r]=t}}
/**@type {(lhs: string, rhs: string, ctx: string, noremap?: boolean) => void} */map(e,t,n,o){if(e!=":"&&e.charAt(0)==":"){if(n)throw Error("Mode not supported for ex mappings");var i=e.substring(1);t!=":"&&t.charAt(0)==":"?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:true}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:true}}else{var a={keys:e,type:"keyToKey",toKeys:t,noremap:!!o};n&&(a.context=n);r.unshift(a)}}
/**@type {(lhs: string, ctx: string) => boolean|void} */unmap(e,t){if(e!=":"&&e.charAt(0)==":"){if(t)throw Error("Mode not supported for ex mappings");var n=e.substring(1);if(this.commandMap_[n]&&this.commandMap_[n].user){delete this.commandMap_[n];return true}}else{var o=e;for(var i=0;i<r.length;i++)if(o==r[i].keys&&r[i].context===t){r.splice(i,1);return true}}}}
/** @typedef { import("./types").ExParams} ExParams */var R={colorscheme:function(e,t){!t.args||t.args.length<1?showConfirm(e,e.getOption("theme")):e.setOption("theme",t.args[0])},map:function(e,t,r,n){var o=t.args;!o||o.length<2?e&&showConfirm(e,"Invalid mapping: "+t.input):B.map(o[0],o[1],r,n)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},omap:function(e,t){this.map(e,t,"operatorPending")},noremap:function(e,t){this.map(e,t,void 0,true)},inoremap:function(e,t){this.map(e,t,"insert",true)},nnoremap:function(e,t){this.map(e,t,"normal",true)},vnoremap:function(e,t){this.map(e,t,"visual",true)},onoremap:function(e,t){this.map(e,t,"operatorPending",true)},unmap:function(e,t,r){var n=t.args;(!n||n.length<1||!B.unmap(n[0],r))&&e&&showConfirm(e,"No such mapping: "+t.input)},mapclear:function(e,t){v.mapclear()},imapclear:function(e,t){v.mapclear("insert")},nmapclear:function(e,t){v.mapclear("normal")},vmapclear:function(e,t){v.mapclear("visual")},omapclear:function(e,t){v.mapclear("operatorPending")},move:function(e,t){x.processCommand(e,e.state.vim,{keys:"",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:false,explicitRepeat:true,linewise:true},repeatOverride:t.line+1})},set:function(e,t){var r=t.args;var n=t.setCfg||{};if(!r||r.length<1)e&&showConfirm(e,"Invalid mapping: "+t.input);else{var o=r[0].split("=");var i=o.shift()||"";
/**@type {string|boolean|undefined} */var a=o.length>0?o.join("="):void 0;var s=false;var l=false;if(i.charAt(i.length-1)=="?"){if(a)throw Error("Trailing characters: "+t.argString);i=i.substring(0,i.length-1);s=true}else if(i.charAt(i.length-1)=="!"){i=i.substring(0,i.length-1);l=true}if(a===void 0&&i.substring(0,2)=="no"){i=i.substring(2);a=false}var c=d[i]&&d[i].type=="boolean";c&&(l?a=!getOption(i,e,n):a==void 0&&(a=true));if(!c&&a===void 0||s){var u=getOption(i,e,n);u instanceof Error?showConfirm(e,u.message):showConfirm(e,u===true||u===false?" "+(u?"":"no")+i:"  "+i+"="+u)}else{var h=setOption(i,a,e,n);h instanceof Error&&showConfirm(e,h.message)}}},setlocal:function(e,t){t.setCfg={scope:"local"};this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"};this.set(e,t)},registers:function(e,t){var r=t.args;var n=p.registerController.registers;var o="----------Registers----------\n\n";if(r){var i=r.join("");for(var a=0;a<i.length;a++){l=i.charAt(a);if(p.registerController.isValidRegister(l)){var s=n[l]||new Register;o+='"'+l+"    "+s.toString()+"\n"}}}else for(var l in n){var c=n[l].toString();c.length&&(o+='"'+l+"    "+c+"\n")}showConfirm(e,o)},sort:function(r,n){var o,i,a,s,l;function parseArgs(){if(n.argString){var t=new e.StringStream(n.argString);t.eat("!")&&(o=true);if(t.eol())return;if(!t.eatSpace())return"Invalid arguments";var r=t.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!r||!t.eol())return"Invalid arguments";if(r[1]){i=r[1].indexOf("i")!=-1;a=r[1].indexOf("u")!=-1;var c=r[1].indexOf("d")!=-1||r[1].indexOf("n")!=-1;var u=r[1].indexOf("x")!=-1;var h=r[1].indexOf("o")!=-1;if(Number(c)+Number(u)+Number(h)>1)return"Invalid arguments";s=(c?"decimal":u&&"hex")||h&&"octal"}r[2]&&(l=new RegExp(r[2].substr(1,r[2].length-2),i?"i":""))}}var c=parseArgs();if(c)showConfirm(r,c+": "+n.argString);else{var u=n.line||r.firstLine();var h=n.lineEnd||n.line||r.lastLine();if(u!=h){var f=new t(u,0);var d=new t(h,lineLength(r,h));var p=r.getRange(f,d).split("\n");var m=s=="decimal"?/(-?)([\d]+)/:s=="hex"?/(-?)(?:0x)?([0-9a-f]+)/i:s=="octal"?/([0-7]+)/:null;var v=s=="decimal"?10:s=="hex"?16:s=="octal"?8:void 0;var g=[],y=[];if(s||l)for(var C=0;C<p.length;C++){var w=l?p[C].match(l):null;w&&w[0]!=""?g.push(w):m&&m.exec(p[C])?g.push(p[C]):y.push(p[C])}else y=p;g.sort(l?comparePatternFn:compareFn);if(l)for(C=0;C<g.length;C++)g[C]=g[C].input;else s||y.sort(compareFn);p=o?g.concat(y):y.concat(g);if(a){var S=p;var k;p=[];for(C=0;C<S.length;C++){S[C]!=k&&p.push(S[C]);k=S[C]}}r.replaceRange(p.join("\n"),f,d)}}function compareFn(e,t){if(o){var r;r=e;e=t;t=r}if(i){e=e.toLowerCase();t=t.toLowerCase()}var n=m&&m.exec(e);var a=m&&m.exec(t);if(!n||!a)return e<t?-1:1;var s=parseInt((n[1]+n[2]).toLowerCase(),v);var l=parseInt((a[1]+a[2]).toLowerCase(),v);return s-l}function comparePatternFn(e,t){if(o){var r;r=e;e=t;t=r}if(i){e[0]=e[0].toLowerCase();t[0]=t[0].toLowerCase()}return e[0]<t[0]?-1:1}},vglobal:function(e,t){this.global(e,t)},normal:function(e,t){var r=t.argString;if(r&&r[0]=="!"){r=r.slice(1);y=true}r=r.trimStart();if(r){var n=t.line;if(typeof n=="number"){var o=isNaN(t.lineEnd)?n:t.lineEnd;for(var i=n;i<=o;i++){e.setCursor(i,0);doKeyToKey(e,t.argString.trimStart());e.state.vim.insertMode&&exitInsertMode(e,true)}}else{doKeyToKey(e,t.argString.trimStart());e.state.vim.insertMode&&exitInsertMode(e,true)}}else showConfirm(e,"Argument is required.")},global:function(e,t){var r=t.argString;if(r){var n=t.commandName[0]==="v";if(r[0]==="!"&&t.commandName[0]==="g"){n=true;r=r.slice(1)}var o=t.line!==void 0?t.line:e.firstLine();var i=t.lineEnd||t.line||e.lastLine();var a=splitBySlash(r);var s=r,l="";if(a&&a.length){s=a[0];l=a.slice(1,a.length).join("/")}if(s)try{updateSearchQuery(e,s,true,true)}catch(t){showConfirm(e,"Invalid regex: "+s);return}var c=getSearchState(e).getQuery();
/**@type {(string|import("./types").LineHandle)[]}*/var u=[];for(var h=o;h<=i;h++){var f=e.getLine(h);var d=c.test(f);d!==n&&u.push(l?e.getLineHandle(h):f)}if(l){var p=0;var nextCommand=function(){if(p<u.length){var t=u[p++];var r=e.getLineNumber(t);if(r==null){nextCommand();return}var n=r+1+l;B.processCommand(e,n,{callback:nextCommand})}else e.releaseLineHandles&&e.releaseLineHandles()};nextCommand()}else showConfirm(e,u.join("\n"))}else showConfirm(e,"Regular Expression missing from global")},substitute:function(e,r){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var n=r.argString;var o=n?splitBySeparator(n,n[0]):[];var i,a,s,l="",c="";var u=false;var h=false;if(o&&o.length){l=o[0];getOption("pcre")&&l!==""&&(l=new RegExp(l).source);c=o[1];if(c!==void 0){c=getOption("pcre")?unescapeRegexReplace(c.replace(/([^\\])&/g,"$1$$&")):translateRegexReplace(c);p.lastSubstituteReplacePart=c}i=o[2]?o[2].split(" "):[]}else if(n&&n.length){showConfirm(e,"Substitutions should be of the form :s/pattern/replace/");return}if(i){a=i[0];s=parseInt(i[1]);if(a){a.indexOf("c")!=-1&&(u=true);a.indexOf("g")!=-1&&(h=true);l=getOption("pcre")?l+"/"+a:l.replace(/\//g,"\\/")+"/"+a}}if(l)try{updateSearchQuery(e,l,true,true)}catch(t){showConfirm(e,"Invalid regex: "+l);return}c=c||p.lastSubstituteReplacePart;if(c!==void 0){var f=getSearchState(e);var d=f.getQuery();var m=r.line!==void 0?r.line:e.getCursor().line;var v=r.lineEnd||m;m==e.firstLine()&&v==e.lastLine()&&(v=Infinity);if(s){m=v;v=m+s-1}var g=clipCursorToContent(e,new t(m,0));var y=e.getSearchCursor(d,g);doReplace(e,u,h,m,v,y,d,c,r.callback)}else showConfirm(e,"No previous substitute regular expression")},startinsert:function(e,t){doKeyToKey(e,t.argString=="!"?"A":"i",{})},redo:e.commands.redo,undo:e.commands.undo,write:function(t){e.commands.save?e.commands.save(t):t.save&&t.save()},nohlsearch:function(e){clearSearchHighlight(e)},yank:function(e){var t=copyCursor(e.getCursor());var r=t.line;var n=e.getLine(r);p.registerController.pushText("0","yank",n,true,true)},delete:function(e,r){var n=r.selectionLine;var o=isNaN(r.selectionLineEnd)?n:r.selectionLineEnd;L.delete(e,{linewise:true},[{anchor:new t(n,0),head:new t(o+1,0)}])},join:function(e,r){var n=r.selectionLine;var o=isNaN(r.selectionLineEnd)?n:r.selectionLineEnd;e.setCursor(new t(n,0));b.joinLines(e,{repeat:o-n},e.state.vim)},delmarks:function(t,r){if(r.argString&&trim(r.argString)){var n=t.state.vim;var o=new e.StringStream(trim(r.argString));while(!o.eol()){o.eatSpace();var i=o.pos;if(!o.match(/[a-zA-Z]/,false)){showConfirm(t,"Invalid argument: "+r.argString.substring(i));return}var a=o.next();if(o.match("-",true)){if(!o.match(/[a-zA-Z]/,false)){showConfirm(t,"Invalid argument: "+r.argString.substring(i));return}var s=a;var l=o.next();if(!s||!l||isLowerCase(s)!=isLowerCase(l)){showConfirm(t,"Invalid argument: "+s+"-");return}var c=s.charCodeAt(0);var u=l.charCodeAt(0);if(c>=u){showConfirm(t,"Invalid argument: "+r.argString.substring(i));return}for(var h=0;h<=u-c;h++){var f=String.fromCharCode(c+h);delete n.marks[f]}}else a&&delete n.marks[a]}}else showConfirm(t,"Argument required")}};var B=new ExCommandDispatcher;function doReplace(t,r,n,o,i,a,s,l,c){t.state.vim.exMode=true;var u=false;
/** @type {Pos}*/var h;
/** @type {number}*/var f;
/** @type {boolean}*/var d;function replaceAll(){t.operation((function(){while(!u){replace();next()}stop()}))}function replace(){var e=t.getRange(a.from(),a.to());var r=e.replace(s,l);var n=a.to().line;a.replace(r);f=a.to().line;i+=f-n;d=f<n}function findNextValidMatch(){var e=h&&copyCursor(a.to());var t=a.findNext();t&&!t[0]&&e&&cursorEqual(a.from(),e)&&(t=a.findNext());return t}function next(){while(findNextValidMatch()&&isInRange(a.from(),o,i))if(n||a.from().line!=f||d){t.scrollIntoView(a.from(),30);t.setSelection(a.from(),a.to());h=a.from();u=false;return}u=true}function stop(e){e&&e();t.focus();if(h){t.setCursor(h);var r=t.state.vim;r.exMode=false;r.lastHPos=r.lastHSPos=h.ch}c&&c()}function onPromptKeyDown(r,n,o){e.e_stop(r);var i=vimKeyFromEvent(r);switch(i){case"y":replace();next();break;case"n":next();break;case"a":var a=c;c=void 0;t.operation(replaceAll);c=a;break;case"l":replace();case"q":case"<Esc>":case"<C-c>":case"<C-[>":stop(o);break}u&&stop(o);return true}next();if(u)showConfirm(t,"No matches for "+s.source);else if(r)showPrompt(t,{prefix:dom("span","replace with ",dom("strong",l)," (y/n/a/q/l)"),onKeyDown:onPromptKeyDown});else{replaceAll();c&&c()}}function exitInsertMode(t,r){var n=t.state.vim;var o=p.macroModeState;var i=p.registerController.getRegister(".");var a=o.isPlaying;var s=o.lastInsertModeChanges;if(!a){t.off("change",onChange);n.insertEnd&&n.insertEnd.clear();n.insertEnd=void 0;e.off(t.getInputField(),"keydown",onKeyEventTargetKeyDown)}if(!a&&n.insertModeRepeat>1){repeatLastEdit(t,n,n.insertModeRepeat-1,true);n.lastEditInputState.repeatOverride=n.insertModeRepeat}delete n.insertModeRepeat;n.insertMode=false;r||t.setCursor(t.getCursor().line,t.getCursor().ch-1);t.setOption("keyMap","vim");t.setOption("disableInput",true);t.toggleOverwrite(false);i.setText(s.changes.join(""));e.signal(t,"vim-mode-change",{mode:"normal"});o.isRecording&&logInsertModeChange(o)}function _mapCommand(e){r.unshift(e)}function mapCommand(e,t,r,n,o){
/**@type{any} */
var i={keys:e,type:t};i[t]=r;i[t+"Args"]=n;for(var a in o)i[a]=o[a];_mapCommand(i)}defineOption("insertModeEscKeysTimeout",200,"number");function executeMacroRegister(e,t,r,n){var o=p.registerController.getRegister(n);if(n!=":"){var i=o.keyBuffer;var a=0;r.isPlaying=true;r.replaySearchQueries=o.searchQueries.slice(0);for(var s=0;s<i.length;s++){var l=i[s];var c,u;var h=/<(?:[CSMA]-)*\w+>|./gi;while(c=h.exec(l)){u=c[0];v.handleKey(e,u,"macro");if(t.insertMode){var f=o.insertModeChanges[a++].changes;p.macroModeState.lastInsertModeChanges.changes=f;repeatInsertModeChanges(e,f,1);exitInsertMode(e)}}}r.isPlaying=false}else{o.keyBuffer[0]&&B.processCommand(e,o.keyBuffer[0]);r.isPlaying=false}}function logKey(e,t){if(!e.isPlaying){var r=e.latestRegister;var n=p.registerController.getRegister(r);n&&n.pushText(t)}}function logInsertModeChange(e){if(!e.isPlaying){var t=e.latestRegister;var r=p.registerController.getRegister(t);r&&r.pushInsertModeChanges&&r.pushInsertModeChanges(e.lastInsertModeChanges)}}function logSearchQuery(e,t){if(!e.isPlaying){var r=e.latestRegister;var n=p.registerController.getRegister(r);n&&n.pushSearchQuery&&n.pushSearchQuery(t)}}function onChange(e,t){var r=p.macroModeState;var n=r.lastInsertModeChanges;if(!r.isPlaying){var o=e.state.vim;while(t){n.expectCursorActivityForChange=true;if(n.ignoreCount>1)n.ignoreCount--;else if(t.origin=="+input"||t.origin=="paste"||t.origin===void 0){var i=e.listSelections().length;i>1&&(n.ignoreCount=i);var a=t.text.join("\n");if(n.maybeReset){n.changes=[];n.maybeReset=false}if(a)if(e.state.overwrite&&!/\n/.test(a))n.changes.push([a]);else{if(a.length>1){var s=o&&o.insertEnd&&o.insertEnd.find();var l=e.getCursor();if(s&&s.line==l.line){var c=s.ch-l.ch;if(c>0&&c<a.length){n.changes.push([a,c]);a=""}}}a&&n.changes.push(a)}}t=t.next}}}function onCursorActivity(e){var t=e.state.vim;if(t.insertMode){var r=p.macroModeState;if(r.isPlaying)return;var n=r.lastInsertModeChanges;if(n.expectCursorActivityForChange)n.expectCursorActivityForChange=false;else{n.maybeReset=true;t.insertEnd&&t.insertEnd.clear();t.insertEnd=e.setBookmark(e.getCursor(),{insertLeft:true})}}else e.curOp?.isVimOp||handleExternalSelection(e,t)}function handleExternalSelection(t,r){var n=t.getCursor("anchor");var o=t.getCursor("head");if(r.visualMode&&!t.somethingSelected())exitVisualMode(t,false);else if(!r.visualMode&&!r.insertMode&&t.somethingSelected()){r.visualMode=true;r.visualLine=false;e.signal(t,"vim-mode-change",{mode:"visual"})}if(r.visualMode){var i=cursorIsBefore(o,n)?0:-1;var a=cursorIsBefore(o,n)?-1:0;o=offsetCursor(o,0,i);n=offsetCursor(n,0,a);r.sel={anchor:n,head:o};updateMark(t,r,"<",cursorMin(o,n));updateMark(t,r,">",cursorMax(o,n))}else r.insertMode||(r.lastHPos=t.getCursor().ch)}function InsertModeKey(e,t){this.keyName=e;this.key=t.key;this.ctrlKey=t.ctrlKey;this.altKey=t.altKey;this.metaKey=t.metaKey;this.shiftKey=t.shiftKey}function onKeyEventTargetKeyDown(t){var r=p.macroModeState;var n=r.lastInsertModeChanges;var o=e.keyName?e.keyName(t):t.key;if(o&&(o.indexOf("Delete")!=-1||o.indexOf("Backspace")!=-1)){if(n.maybeReset){n.changes=[];n.maybeReset=false}n.changes.push(new InsertModeKey(o,t))}}function repeatLastEdit(e,t,r,n){var o=p.macroModeState;o.isPlaying=true;var i=t.lastEditActionCommand;var a=t.inputState;function repeatCommand(){i?x.processAction(e,t,i):x.evalInput(e,t)}function repeatInsert(r){if(o.lastInsertModeChanges.changes.length>0){r=t.lastEditActionCommand?r:1;var n=o.lastInsertModeChanges;repeatInsertModeChanges(e,n.changes,r)}}t.inputState=t.lastEditInputState;if(i&&i.interlaceInsertRepeat)for(var s=0;s<r;s++){repeatCommand();repeatInsert(1)}else{n||repeatCommand();repeatInsert(r)}t.inputState=a;t.insertMode&&!n&&exitInsertMode(e);o.isPlaying=false}function sendCmKey(t,r){e.lookupKey(r,"vim-insert",(function keyHandler(r){typeof r=="string"?e.commands[r](t):r(t);return true}))}function repeatInsertModeChanges(e,t,r){var n=e.getCursor("head");var o=p.macroModeState.lastInsertModeChanges.visualBlock;if(o){selectForInsert(e,n,o+1);r=e.listSelections().length;e.setCursor(n)}for(var i=0;i<r;i++){o&&e.setCursor(offsetCursor(n,i,0));for(var a=0;a<t.length;a++){var s=t[a];if(s instanceof InsertModeKey)sendCmKey(e,s.keyName);else if(typeof s=="string")e.replaceSelection(s);else{var l=e.getCursor();var c=offsetCursor(l,0,s[0].length-(s[1]||0));e.replaceRange(s[0],l,s[1]?l:c);e.setCursor(c)}}}o&&e.setCursor(offsetCursor(n,0,1))}function cloneVimState(e){var t=new e.constructor;Object.keys(e).forEach((function(r){if(r!="insertEnd"){var n=e[r];Array.isArray(n)?n=n.slice():n&&typeof n=="object"&&n.constructor!=Object&&(n=cloneVimState(n));t[r]=n}}));e.sel&&(t.sel={head:e.sel.head&&copyCursor(e.sel.head),anchor:e.sel.anchor&&copyCursor(e.sel.anchor)});return t}function multiSelectHandleKey(e,t,r){var n=maybeInitVimState(e);var o=/**@type {CodeMirrorV}*/e;
/** @type {boolean | undefined} */var i=false;n=v.maybeInitVimState_(o);var a=n.visualBlock||n.wasInVisualBlock;var s=o.isInMultiSelectMode();n.wasInVisualBlock&&!s?n.wasInVisualBlock=false:s&&n.visualBlock&&(n.wasInVisualBlock=true);if(t!="<Esc>"||n.insertMode||n.visualMode||!s||n.status!="<Esc>")if(a||!s||o.inVirtualSelectionMode)i=v.handleKey(o,t,r);else{var l=cloneVimState(n);var c=n.inputState.changeQueueList||[];o.operation((function(){o.curOp&&(o.curOp.isVimOp=true);var e=0;o.forEachSelection((function(){o.state.vim.inputState.changeQueue=c[e];var n=o.getCursor("head");var a=o.getCursor("anchor");var s=cursorIsBefore(n,a)?0:-1;var u=cursorIsBefore(n,a)?-1:0;n=offsetCursor(n,0,s);a=offsetCursor(a,0,u);o.state.vim.sel.head=n;o.state.vim.sel.anchor=a;i=v.handleKey(o,t,r);if(o.virtualSelection){c[e]=o.state.vim.inputState.changeQueue;o.state.vim=cloneVimState(l)}e++}));o.curOp?.cursorActivity&&!i&&(o.curOp.cursorActivity=false);o.state.vim=n;n.inputState.changeQueueList=c;n.inputState.changeQueue=null}),true)}else clearInputState(o);!i||n.visualMode||n.insert||n.visualMode==o.somethingSelected()||handleExternalSelection(o,n);return i}resetVimGlobalState();return v}function indexFromPos(e,t){var r=t.ch;var n=t.line+1;if(n<1){n=1;r=0}if(n>e.lines){n=e.lines;r=Number.MAX_VALUE}var o=e.line(n);return Math.min(o.from+Math.max(0,r),o.to)}function posFromIndex(e,t){let r=e.lineAt(t);return{line:r.number-1,ch:t-r.from}}class Pos{constructor(e,t){this.line=e;this.ch=t}}function on(e,t,r){if(e.addEventListener)e.addEventListener(t,r,false);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||[]).concat(r)}}function off(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,false);else{var n=e._handlers,o=n&&n[t];if(o){var i=o.indexOf(r);i>-1&&(n[t]=o.slice(0,i).concat(o.slice(i+1)))}}}function signal(e,t,...r){var n;var o=(n=e._handlers)===null||n===void 0?void 0:n[t];if(o)for(var i=0;i<o.length;++i)o[i](...r)}function signalTo(e,...t){if(e)for(var r=0;r<e.length;++r)e[r](...t)}let I;try{I=new RegExp("[\\w\\p{Alphabetic}\\p{Number}_]","u")}catch(e){I=/[\w]/}function dispatchChange(e,t){var r=e.cm6;if(!r.state.readOnly){var n="input.type.compose";e.curOp&&(e.curOp.lastChange||(n="input.type.compose.start"));if(t.annotations)try{t.annotations.some((function(e){e.value=="input"&&(e.value=n)}))}catch(e){console.error(e)}else t.userEvent=n;return r.dispatch(t)}}function runHistoryCommand(e,t){var r;e.curOp&&(e.curOp.$changeStart=void 0);(t?S:k)(e.cm6);let n=(r=e.curOp)===null||r===void 0?void 0:r.$changeStart;n!=null&&e.cm6.dispatch({selection:{anchor:n}})}var R={};"Left|Right|Up|Down|Backspace|Delete".split("|").forEach((e=>{R[e]=t=>f(t.cm6,{key:e},"editor")}));class CodeMirror{constructor(e){this.state={};this.marks=Object.create(null);this.$mid=0;this.options={};this._handlers={};this.$lastChangeEndOffset=0;this.virtualSelection=null;this.cm6=e;this.onChange=this.onChange.bind(this);this.onSelectionChange=this.onSelectionChange.bind(this)}openDialog(e,t,r){return openDialog(this,e,t,r)}openNotification(e,t){return openNotification(this,e,t)}on(e,t){on(this,e,t)}off(e,t){off(this,e,t)}signal(e,t,r){signal(this,e,t,r)}indexFromPos(e){return indexFromPos(this.cm6.state.doc,e)}posFromIndex(e){return posFromIndex(this.cm6.state.doc,e)}foldCode(t){let r=this.cm6;let n=r.state.selection.ranges;let o=this.cm6.state.doc;let i=indexFromPos(o,t);let s=e.create([e.range(i,i)],0).ranges;r.state.selection.ranges=s;a(r);r.state.selection.ranges=n}firstLine(){return 0}lastLine(){return this.cm6.state.doc.lines-1}lineCount(){return this.cm6.state.doc.lines}setCursor(e,t){if(typeof e==="object"){t=e.ch;e=e.line}var r=indexFromPos(this.cm6.state.doc,{line:e,ch:t||0});this.cm6.dispatch({selection:{anchor:r}},{scrollIntoView:!this.curOp});this.curOp&&!this.curOp.isVimOp&&this.onBeforeEndOperation()}getCursor(e){var t=this.cm6.state.selection.main;var r=e!="head"&&e?e=="anchor"?t.anchor:e=="start"?t.from:e=="end"?t.to:null:t.head;if(r==null)throw new Error("Invalid cursor type");return this.posFromIndex(r)}listSelections(){var e=this.cm6.state.doc;return this.cm6.state.selection.ranges.map((t=>({anchor:posFromIndex(e,t.anchor),head:posFromIndex(e,t.head)})))}setSelections(t,r){var n=this.cm6.state.doc;var o=t.map((t=>{var r=indexFromPos(n,t.head);var o=indexFromPos(n,t.anchor);return r==o?e.cursor(r,1):e.range(o,r)}));this.cm6.dispatch({selection:e.create(o,r)})}setSelection(e,t,r){this.setSelections([{anchor:e,head:t}],0);r&&r.origin=="*mouse"&&this.onBeforeEndOperation()}getLine(e){var t=this.cm6.state.doc;return e<0||e>=t.lines?"":this.cm6.state.doc.line(e+1).text}getLineHandle(e){this.$lineHandleChanges||(this.$lineHandleChanges=[]);return{row:e,index:this.indexFromPos(new Pos(e,0))}}getLineNumber(e){var r=this.$lineHandleChanges;if(!r)return null;var n=e.index;for(var o=0;o<r.length;o++){n=r[o].changes.mapPos(n,1,t.TrackAfter);if(n==null)return null}var i=this.posFromIndex(n);return i.ch==0?i.line:null}releaseLineHandles(){this.$lineHandleChanges=void 0}getRange(e,t){var r=this.cm6.state.doc;return this.cm6.state.sliceDoc(indexFromPos(r,e),indexFromPos(r,t))}replaceRange(e,t,r,n){r||(r=t);var o=this.cm6.state.doc;var i=indexFromPos(o,t);var a=indexFromPos(o,r);dispatchChange(this,{changes:{from:i,to:a,insert:e}})}replaceSelection(e){dispatchChange(this,this.cm6.state.replaceSelection(e))}replaceSelections(e){var t=this.cm6.state.selection.ranges;var r=t.map(((t,r)=>({from:t.from,to:t.to,insert:e[r]||""})));dispatchChange(this,{changes:r})}getSelection(){return this.getSelections().join("\n")}getSelections(){var e=this.cm6;return e.state.selection.ranges.map((t=>e.state.sliceDoc(t.from,t.to)))}somethingSelected(){return this.cm6.state.selection.ranges.some((e=>!e.empty))}getInputField(){return this.cm6.contentDOM}clipPos(e){var t=this.cm6.state.doc;var r=e.ch;var n=e.line+1;if(n<1){n=1;r=0}if(n>t.lines){n=t.lines;r=Number.MAX_VALUE}var o=t.line(n);r=Math.min(Math.max(0,r),o.to-o.from);return new Pos(n-1,r)}getValue(){return this.cm6.state.doc.toString()}setValue(t){var r=this.cm6;return r.dispatch({changes:{from:0,to:r.state.doc.length,insert:t},selection:e.range(0,0)})}focus(){return this.cm6.focus()}blur(){return this.cm6.contentDOM.blur()}defaultTextHeight(){return this.cm6.defaultLineHeight}findMatchingBracket(e,t){var r=this.cm6.state;var n=indexFromPos(r.doc,e);var o=s(r,n+1,-1);if(o&&o.end)return{to:posFromIndex(r.doc,o.end.from)};o=s(r,n,1);return o&&o.end?{to:posFromIndex(r.doc,o.end.from)}:{to:void 0}}scanForBracket(e,t,r,n){return scanForBracket(this,e,t,r,n)}indentLine(e,t){t?this.indentMore():this.indentLess()}indentMore(){x(this.cm6)}indentLess(){M(this.cm6)}execCommand(e){if(e=="indentAuto")CodeMirror.commands.indentAuto(this);else if(e=="goLineLeft")L(this.cm6);else if(e=="goLineRight"){b(this.cm6);let e=this.cm6.state;let t=e.selection.main.head;t<e.doc.length&&e.sliceDoc(t,t+1)!=="\n"&&A(this.cm6)}else console.log(e+" is not implemented")}setBookmark(e,t){var r=(t===null||t===void 0?void 0:t.insertLeft)?1:-1;var n=this.indexFromPos(e);var o=new Marker(this,n,r);return o}addOverlay({query:e}){let t=new y({regexp:true,search:e.source,caseSensitive:!/i/.test(e.flags)});if(t.valid){t.forVim=true;this.cm6Query=t;let e=C.of(t);this.cm6.dispatch({effects:e});return t}}removeOverlay(e){if(!this.cm6Query)return;this.cm6Query.forVim=false;let t=C.of(this.cm6Query);this.cm6.dispatch({effects:t})}getSearchCursor(e,t){var r=this;var n=null;var o=null;t.ch==void 0&&(t.ch=Number.MAX_VALUE);var i=indexFromPos(r.cm6.state.doc,t);var a=e.source.replace(/(\\.|{(?:\d+(?:,\d*)?|,\d+)})|[{}]/g,(function(e,t){return t||"\\"+e}));function rCursor(t,r=0,n=t.length){return new w(t,a,{ignoreCase:e.ignoreCase},r,n)}function nextMatch(e){var t=r.cm6.state.doc;if(e>t.length)return null;let n=rCursor(t,e).next();return n.done?null:n.value}var s=1e4;function prevMatchInRange(e,t){var n=r.cm6.state.doc;for(let r=1;;r++){let o=Math.max(e,t-r*s);let i=rCursor(n,o,t),a=null;while(!i.next().done)a=i.value;if(a&&(o==e||a.from>o+10))return a;if(o==e)return null}}return{findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(e){var t=r.cm6.state.doc;if(e){let e=n?n.from==n.to?n.to-1:n.from:i;n=prevMatchInRange(0,e)}else{let e=n?n.from==n.to?n.to+1:n.to:i;n=nextMatch(e)}o=n&&{from:posFromIndex(t,n.from),to:posFromIndex(t,n.to),match:n.match};return n&&n.match},from:function(){return o===null||o===void 0?void 0:o.from},to:function(){return o===null||o===void 0?void 0:o.to},replace:function(e){if(n){dispatchChange(r,{changes:{from:n.from,to:n.to,insert:e}});n.to=n.from+e.length;o&&(o.to=posFromIndex(r.cm6.state.doc,n.to))}}}}findPosV(t,r,n,o){let{cm6:i}=this;const a=i.state.doc;let s=n=="page"?i.dom.clientHeight:0;const l=indexFromPos(a,t);let c=e.cursor(l,1,void 0,o);let u=Math.round(Math.abs(r));for(let e=0;e<u;e++)n=="page"?c=i.moveVertically(c,r>0,s):n=="line"&&(c=i.moveVertically(c,r>0));let h=posFromIndex(a,c.head);(r<0&&c.head==0&&o!=0&&t.line==0&&t.ch!=0||r>0&&c.head==a.length&&h.ch!=o&&t.line==h.line)&&(h.hitSide=true);return h}charCoords(e,t){var r=this.cm6.contentDOM.getBoundingClientRect();var n=indexFromPos(this.cm6.state.doc,e);var o=this.cm6.coordsAtPos(n);var i=-r.top;return{left:((o===null||o===void 0?void 0:o.left)||0)-r.left,top:((o===null||o===void 0?void 0:o.top)||0)+i,bottom:((o===null||o===void 0?void 0:o.bottom)||0)+i}}coordsChar(e,t){var r=this.cm6.contentDOM.getBoundingClientRect();var n=this.cm6.posAtCoords({x:e.left+r.left,y:e.top+r.top})||0;return posFromIndex(this.cm6.state.doc,n)}getScrollInfo(){var e=this.cm6.scrollDOM;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight,width:e.scrollWidth,clientHeight:e.clientHeight,clientWidth:e.clientWidth}}scrollTo(e,t){e!=null&&(this.cm6.scrollDOM.scrollLeft=e);t!=null&&(this.cm6.scrollDOM.scrollTop=t)}scrollIntoView(e,t){if(e){var r=this.indexFromPos(e);this.cm6.dispatch({effects:d.scrollIntoView(r)})}else this.cm6.dispatch({scrollIntoView:true,userEvent:"scroll"})}getWrapperElement(){return this.cm6.dom}getMode(){return{name:this.getOption("mode")}}setSize(e,t){this.cm6.dom.style.width=e+4+"px";this.cm6.dom.style.height=t+"px";this.refresh()}refresh(){this.cm6.measure()}destroy(){this.removeOverlay()}getLastEditEnd(){return this.posFromIndex(this.$lastChangeEndOffset)}onChange(e){this.$lineHandleChanges&&this.$lineHandleChanges.push(e);for(let t in this.marks){let r=this.marks[t];r.update(e.changes)}this.virtualSelection&&(this.virtualSelection.ranges=this.virtualSelection.ranges.map((t=>t.map(e.changes))));var t=this.curOp=this.curOp||{};e.changes.iterChanges(((e,r,n,o,i)=>{(t.$changeStart==null||t.$changeStart>n)&&(t.$changeStart=n);this.$lastChangeEndOffset=o;var a={text:i.toJSON()};t.lastChange?t.lastChange.next=t.lastChange=a:t.lastChange=t.change=a}),true);t.changeHandlers||(t.changeHandlers=this._handlers.change&&this._handlers.change.slice())}onSelectionChange(){var e=this.curOp=this.curOp||{};e.cursorActivityHandlers||(e.cursorActivityHandlers=this._handlers.cursorActivity&&this._handlers.cursorActivity.slice());this.curOp.cursorActivity=true}operation(e,t){this.curOp||(this.curOp={$d:0});this.curOp.$d++;try{var r=e()}finally{if(this.curOp){this.curOp.$d--;this.curOp.$d||this.onBeforeEndOperation()}}return r}onBeforeEndOperation(){var e=this.curOp;var t=false;if(e){e.change&&signalTo(e.changeHandlers,this,e.change);if(e&&e.cursorActivity){signalTo(e.cursorActivityHandlers,this,null);e.isVimOp&&(t=true)}this.curOp=null}t&&this.scrollIntoView()}moveH(e,t){if(t=="char"){var r=this.getCursor();this.setCursor(r.line,r.ch+e)}}setOption(e,t){switch(e){case"keyMap":this.state.keyMap=t;break;case"textwidth":this.state.textwidth=t;break}}getOption(e){switch(e){case"firstLineNumber":return 1;case"tabSize":return this.cm6.state.tabSize||4;case"readOnly":return this.cm6.state.readOnly;case"indentWithTabs":return this.cm6.state.facet(l)=="\t";case"indentUnit":return this.cm6.state.facet(l).length||2;case"textwidth":return this.state.textwidth;case"keyMap":return this.state.keyMap||"vim"}}toggleOverwrite(e){this.state.overwrite=e}getTokenTypeAt(e){var t;var r=this.indexFromPos(e);var n=c(this.cm6.state,r);var o=n===null||n===void 0?void 0:n.resolve(r);var i=((t=o===null||o===void 0?void 0:o.type)===null||t===void 0?void 0:t.name)||"";return/comment/i.test(i)?"comment":/string/i.test(i)?"string":""}overWriteSelection(t){var r=this.cm6.state.doc;var n=this.cm6.state.selection;var o=n.ranges.map((t=>{if(t.empty){var n=t.to<r.length?r.sliceString(t.from,t.to+1):"";if(n&&!/\n/.test(n))return e.range(t.from,t.to+1)}return t}));this.cm6.dispatch({selection:e.create(o,n.mainIndex)});this.replaceSelection(t)}isInMultiSelectMode(){return this.cm6.state.selection.ranges.length>1}virtualSelectionMode(){return!!this.virtualSelection}forEachSelection(t){var r=this.cm6.state.selection;this.virtualSelection=e.create(r.ranges,r.mainIndex);for(var n=0;n<this.virtualSelection.ranges.length;n++){var o=this.virtualSelection.ranges[n];if(o){this.cm6.dispatch({selection:e.create([o])});t();this.virtualSelection.ranges[n]=this.cm6.state.selection.ranges[0]}}this.cm6.dispatch({selection:this.virtualSelection});this.virtualSelection=null}hardWrap(e){return hardWrap(this,e)}}CodeMirror.isMac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);CodeMirror.Pos=Pos;CodeMirror.StringStream=u;CodeMirror.commands={cursorCharLeft:function(e){E(e.cm6)},redo:function(e){runHistoryCommand(e,false)},undo:function(e){runHistoryCommand(e,true)},newlineAndIndent:function(e){T({state:e.cm6.state,dispatch:t=>dispatchChange(e,t)})},indentAuto:function(e){O(e.cm6)},newlineAndIndentContinueComment:void 0,save:void 0};CodeMirror.isWordChar=function(e){return I.test(e)};CodeMirror.keys=R;CodeMirror.addClass=function(e,t){};CodeMirror.rmClass=function(e,t){};CodeMirror.e_preventDefault=function(e){e.preventDefault()};CodeMirror.e_stop=function(e){var t,r;(t=e===null||e===void 0?void 0:e.stopPropagation)===null||t===void 0?void 0:t.call(e);(r=e===null||e===void 0?void 0:e.preventDefault)===null||r===void 0?void 0:r.call(e)};CodeMirror.lookupKey=function lookupKey(e,t,r){var n=CodeMirror.keys[e];n&&r(n)};CodeMirror.on=on;CodeMirror.off=off;CodeMirror.signal=signal;CodeMirror.findMatchingTag=findMatchingTag;CodeMirror.findEnclosingTag=findEnclosingTag;CodeMirror.keyName=void 0;function dialogDiv(e,t,r){var n=document.createElement("div");n.appendChild(t);return n}function closeNotification(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose();e.state.currentNotificationClose=t}function openNotification(e,t,r){closeNotification(e,close);var n=dialogDiv(e,t,r&&r.bottom);var o=false;var i;var a=r&&typeof r.duration!=="undefined"?r.duration:5e3;function close(){if(!o){o=true;clearTimeout(i);n.remove();hideDialog(e,n)}}n.onclick=function(e){e.preventDefault();close()};showDialog(e,n);a&&(i=setTimeout(close,a));return close}function showDialog(e,t){var r=e.state.dialog;e.state.dialog=t;if(t&&r!==t){r&&r.contains(document.activeElement)&&e.focus();r&&r.parentElement?r.parentElement.replaceChild(t,r):r&&r.remove();CodeMirror.signal(e,"dialog")}}function hideDialog(e,t){if(e.state.dialog==t){e.state.dialog=null;CodeMirror.signal(e,"dialog")}}function openDialog(e,t,r,n){n||(n={});closeNotification(e,void 0);var o=dialogDiv(e,t,n.bottom);var i=false;showDialog(e,o);function close(t){if(typeof t=="string")a.value=t;else{if(i)return;i=true;hideDialog(e,o);e.state.dialog||e.focus();n.onClose&&n.onClose(o)}}var a=o.getElementsByTagName("input")[0];if(a){if(n.value){a.value=n.value;n.selectValueOnOpen!==false&&a.select()}n.onInput&&CodeMirror.on(a,"input",(function(e){n.onInput(e,a.value,close)}));n.onKeyUp&&CodeMirror.on(a,"keyup",(function(e){n.onKeyUp(e,a.value,close)}));CodeMirror.on(a,"keydown",(function(e){if(!(n&&n.onKeyDown&&n.onKeyDown(e,a.value,close))){e.keyCode==13&&r(a.value);if(e.keyCode==27||n.closeOnEnter!==false&&e.keyCode==13){a.blur();CodeMirror.e_stop(e);close()}}}));n.closeOnBlur!==false&&CodeMirror.on(a,"blur",(function(){setTimeout((function(){document.activeElement!==a&&close()}))}));a.focus()}return close}var B={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function bracketRegex(e){return e&&e.bracketRegex||/[(){}[\]]/}function scanForBracket(e,t,r,n,o){var i=o&&o.maxScanLineLength||1e4;var a=o&&o.maxScanLines||1e3;var s=[];var l=bracketRegex(o);var c=r>0?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a);for(var u=t.line;u!=c;u+=r){var h=e.getLine(u);if(h){var f=r>0?0:h.length-1,d=r>0?h.length:-1;if(!(h.length>i)){u==t.line&&(f=t.ch-(r<0?1:0));for(;f!=d;f+=r){var p=h.charAt(f);if(l.test(p)){var m=B[p];if(m&&m.charAt(1)==">"==r>0)s.push(p);else{if(!s.length)return{pos:new Pos(u,f),ch:p};s.pop()}}}}}}return u-r!=(r>0?e.lastLine():e.firstLine())&&null}function findMatchingTag(e,t){}function findEnclosingTag(e,t){var r,n;var o=e.cm6.state;var i=e.indexFromPos(t);if(i<o.doc.length){var a=o.sliceDoc(i,i+1);a=="<"&&i++}var s=c(o,i);var l=(s===null||s===void 0?void 0:s.resolve(i))||null;while(l){if(((r=l.firstChild)===null||r===void 0?void 0:r.type.name)=="OpenTag"&&((n=l.lastChild)===null||n===void 0?void 0:n.type.name)=="CloseTag")return{open:convertRange(o.doc,l.firstChild),close:convertRange(o.doc,l.lastChild)};l=l.parent}}function convertRange(e,t){return{from:posFromIndex(e,t.from),to:posFromIndex(e,t.to)}}class Marker{constructor(e,t,r){this.cm=e;this.id=e.$mid++;this.offset=t;this.assoc=r;e.marks[this.id]=this}clear(){delete this.cm.marks[this.id]}find(){return this.offset==null?null:this.cm.posFromIndex(this.offset)}update(e){this.offset!=null&&(this.offset=e.mapPos(this.offset,this.assoc,t.TrackDel))}}function hardWrap(e,t){var r;var n=t.column||e.getOption("textwidth")||80;var o=t.allowMerge!=false;var i=Math.min(t.from,t.to);var a=Math.max(t.from,t.to);while(i<=a){var s=e.getLine(i);if(s.length>n){var l=findSpace(s,n,5);if(l){var c=(r=/^\s*/.exec(s))===null||r===void 0?void 0:r[0];e.replaceRange("\n"+c,new Pos(i,l.start),new Pos(i,l.end))}a++}else if(o&&/\S/.test(s)&&i!=a){var u=e.getLine(i+1);if(u&&/\S/.test(u)){var h=s.replace(/\s+$/,"");var f=u.replace(/^\s+/,"");var d=h+" "+f;l=findSpace(d,n,5);if(l&&l.start>h.length||d.length<n){e.replaceRange(" ",new Pos(i,h.length),new Pos(i+1,u.length-f.length));i--;a--}else h.length<s.length&&e.replaceRange("",new Pos(i,h.length),new Pos(i,s.length))}}i++}return i;function findSpace(e,t,r){if(!(e.length<t)){var n=e.slice(0,t);var o=e.slice(t);var i=/^(?:(\s+)|(\S+)(\s+))/.exec(o);var a=/(?:(\s+)|(\s+)(\S+))$/.exec(n);var s=0;var l=0;if(a&&!a[2]){s=t-a[1].length;l=t}if(i&&!i[2]){s||(s=t);l=t+i[1].length}if(s)return{start:s,end:l};if(a&&a[2]&&a.index>r)return{start:a.index,end:a.index+a[2].length};if(i&&i[2]){s=t+i[2].length;return{start:s,end:s+i[3].length}}}}}let N=h.getDrawSelectionConfig||function(){let e={cursorBlinkRate:1200};return function(){return e}}();class Piece{constructor(e,t,r,n,o,i,a,s,l,c){this.left=e;this.top=t;this.height=r;this.fontFamily=n;this.fontSize=o;this.fontWeight=i;this.color=a;this.className=s;this.letter=l;this.partial=c}draw(){let e=document.createElement("div");e.className=this.className;this.adjust(e);return e}adjust(e){e.style.left=this.left+"px";e.style.top=this.top+"px";e.style.height=this.height+"px";e.style.lineHeight=this.height+"px";e.style.fontFamily=this.fontFamily;e.style.fontSize=this.fontSize;e.style.fontWeight=this.fontWeight;e.style.color=this.partial?"transparent":this.color;e.className=this.className;e.textContent=this.letter}eq(e){return this.left==e.left&&this.top==e.top&&this.height==e.height&&this.fontFamily==e.fontFamily&&this.fontSize==e.fontSize&&this.fontWeight==e.fontWeight&&this.color==e.color&&this.className==e.className&&this.letter==e.letter}}class BlockCursorPlugin{constructor(e,t){this.view=e;this.rangePieces=[];this.cursors=[];this.cm=t;this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)};this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div"));this.cursorLayer.className="cm-cursorLayer cm-vimCursorLayer";this.cursorLayer.setAttribute("aria-hidden","true");e.requestMeasure(this.measureReq);this.setBlinkRate()}setBlinkRate(){let e=N(this.cm.cm6.state);let t=e.cursorBlinkRate;this.cursorLayer.style.animationDuration=t+"ms"}update(e){if(e.selectionSet||e.geometryChanged||e.viewportChanged){this.view.requestMeasure(this.measureReq);this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink"}configChanged(e)&&this.setBlinkRate()}scheduleRedraw(){this.view.requestMeasure(this.measureReq)}readPos(){let{state:e}=this.view;let t=[];for(let r of e.selection.ranges){let n=r==e.selection.main;let o=measureCursor(this.cm,this.view,r,n);o&&t.push(o)}return{cursors:t}}drawSel({cursors:e}){if(e.length!=this.cursors.length||e.some(((e,t)=>!e.eq(this.cursors[t])))){let t=this.cursorLayer.children;if(t.length!==e.length){this.cursorLayer.textContent="";for(const t of e)this.cursorLayer.appendChild(t.draw())}else e.forEach(((e,r)=>e.adjust(t[r])));this.cursors=e}}destroy(){this.cursorLayer.remove()}}function configChanged(e){return N(e.startState)!=N(e.state)}const K={".cm-vimMode .cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-fat-cursor":{position:"absolute",background:"#ff9696",border:"none",whiteSpace:"pre"},"&:not(.cm-focused) .cm-fat-cursor":{background:"none",outline:"solid 1px #ff9696",color:"transparent !important"}};const P=r.highest(d.theme(K));function getBase(e){let t=e.scrollDOM.getBoundingClientRect();let r=e.textDirection==p.LTR?t.left:t.right-e.scrollDOM.clientWidth;return{left:r-e.scrollDOM.scrollLeft,top:t.top-e.scrollDOM.scrollTop}}function measureCursor(e,t,r,n){var o,i;let a=r.head;let s=false;let l=1;let c=e.state.vim;if(c&&(!c.insertMode||e.state.overwrite)){s=true;if(c.visualBlock&&!n)return null;r.anchor<r.head&&a--;e.state.overwrite?l=.2:c.status&&(l=.5)}if(s){let e=a<t.state.doc.length&&t.state.sliceDoc(a,a+1);if(e&&/[\uDC00-\uDFFF]/.test(e)&&a>1){a--;e=t.state.sliceDoc(a,a+1)}let r=t.coordsAtPos(a,1);if(!r)return null;let s=getBase(t);let c=t.domAtPos(a);let h=c?c.node:t.contentDOM;while(c&&c.node instanceof HTMLElement){h=c.node;c={node:c.node.childNodes[c.offset],offset:0}}if(!(h instanceof HTMLElement)){if(!h.parentNode)return null;h=h.parentNode}let f=getComputedStyle(h);let d=r.left;let p=(i=(o=t).coordsForChar)===null||i===void 0?void 0:i.call(o,a);p&&(d=p.left);if(e&&e!="\n"&&e!="\r")if(e=="\t"){e=" ";var u=t.coordsAtPos(a+1,-1);u&&(d=u.left-(u.left-r.left)/parseInt(f.tabSize))}else/[\uD800-\uDBFF]/.test(e)&&a<t.state.doc.length-1&&(e+=t.state.sliceDoc(a+1,a+2));else e=" ";let m=r.bottom-r.top;return new Piece(d-s.left,r.top-s.top+m*(1-l),m*l,f.fontFamily,f.fontSize,f.fontWeight,f.color,n?"cm-fat-cursor cm-cursor-primary":"cm-fat-cursor cm-cursor-secondary",e,l!=1)}return null}var F=typeof navigator!="undefined"&&/linux/i.test(navigator.platform)&&/ Gecko\/\d+/.exec(navigator.userAgent);const D=initVim(CodeMirror);const V=250;const W=d.baseTheme({".cm-vimMode .cm-cursorLayer:not(.cm-vimCursorLayer)":{display:"none"},".cm-vim-panel":{padding:"0px 10px",fontFamily:"monospace",minHeight:"1.3em"},".cm-vim-panel input":{border:"none",outline:"none",backgroundColor:"inherit"},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"}});const H=v.fromClass(class{constructor(e){this.status="";this.query=null;this.decorations=m.none;this.waitForCopy=false;this.lastKeydown="";this.useNextTextInput=false;this.compositionText="";this.view=e;const t=this.cm=new CodeMirror(e);D.enterVimMode(this.cm);this.view.cm=this.cm;this.cm.state.vimPlugin=this;this.blockCursor=new BlockCursorPlugin(e,t);this.updateClass();this.cm.on("vim-command-done",(()=>{t.state.vim&&(t.state.vim.status="");this.blockCursor.scheduleRedraw();this.updateStatus()}));this.cm.on("vim-mode-change",(e=>{if(t.state.vim){t.state.vim.mode=e.mode;e.subMode&&(t.state.vim.mode+=" block");t.state.vim.status="";this.blockCursor.scheduleRedraw();this.updateClass();this.updateStatus()}}));this.cm.on("dialog",(()=>{this.cm.state.statusbar?this.updateStatus():e.dispatch({effects:j.of(!!this.cm.state.dialog)})}));this.dom=document.createElement("span");this.dom.style.cssText="position: absolute; right: 10px; top: 1px";this.statusButton=document.createElement("span");this.statusButton.onclick=e=>{D.handleKey(this.cm,"<Esc>","user");this.cm.focus()};this.statusButton.style.cssText="cursor: pointer"}update(e){var t;(e.viewportChanged||e.docChanged)&&this.query&&this.highlight(this.query);e.docChanged&&this.cm.onChange(e);e.selectionSet&&this.cm.onSelectionChange();e.viewportChanged;this.cm.curOp&&!this.cm.curOp.isVimOp&&this.cm.onBeforeEndOperation();if(e.transactions)for(let r of e.transactions)for(let e of r.effects)if(e.is(C)){let r=(t=e.value)===null||t===void 0?void 0:t.forVim;if(r){let t=e.value.create();this.highlight(t)}else this.highlight(null)}this.blockCursor.update(e)}updateClass(){const e=this.cm.state;!e.vim||e.vim.insertMode&&!e.overwrite?this.view.scrollDOM.classList.remove("cm-vimMode"):this.view.scrollDOM.classList.add("cm-vimMode")}updateStatus(){let e=this.cm.state.statusbar;let t=this.cm.state.vim;if(!e||!t)return;let r=this.cm.state.dialog;if(r){if(r.parentElement!=e){e.textContent="";e.appendChild(r)}}else{e.textContent="";var n=(t.mode||"normal").toUpperCase();t.insertModeReturn&&(n+="(C-O)");this.statusButton.textContent=`--${n}--`;e.appendChild(this.statusButton)}this.dom.textContent=t.status;e.appendChild(this.dom)}destroy(){D.leaveVimMode(this.cm);this.updateClass();this.blockCursor.destroy();delete this.view.cm}highlight(e){this.query=e;if(!e)return this.decorations=m.none;let{view:t}=this;let r=new n;for(let n=0,o=t.visibleRanges,i=o.length;n<i;n++){let{from:a,to:s}=o[n];while(n<i-1&&s>o[n+1].from-2*V)s=o[++n].to;e.highlight(t.state,a,s,((e,t)=>{r.add(e,t,_)}))}return this.decorations=r.finish()}handleKey(e,t){const r=this.cm;let n=r.state.vim;if(!n)return;const o=D.vimKeyFromEvent(e,n);CodeMirror.signal(this.cm,"inputEvent",{type:"handleKey",key:o});if(!o)return;if(o=="<Esc>"&&!n.insertMode&&!n.visualMode&&this.query){const e=n.searchState_;if(e){r.removeOverlay(e.getOverlay());e.setOverlay(null)}}let i=o==="<C-c>"&&!CodeMirror.isMac;if(i&&r.somethingSelected()){this.waitForCopy=true;return true}n.status=(n.status||"")+o;let a=D.multiSelectHandleKey(r,o,"user");n=D.maybeInitVimState_(r);if(!a&&n.insertMode&&r.state.overwrite)if(e.key&&e.key.length==1&&!/\n/.test(e.key)){a=true;r.overWriteSelection(e.key)}else if(e.key=="Backspace"){a=true;CodeMirror.commands.cursorCharLeft(r)}if(a){CodeMirror.signal(this.cm,"vim-keypress",o);e.preventDefault();e.stopPropagation();this.blockCursor.scheduleRedraw()}this.updateStatus();return!!a}},{eventHandlers:{copy:function(e,t){if(this.waitForCopy){this.waitForCopy=false;Promise.resolve().then((()=>{var e=this.cm;var t=e.state.vim;t&&(t.insertMode?e.setSelection(e.getCursor(),e.getCursor()):e.operation((()=>{e.curOp&&(e.curOp.isVimOp=true);D.handleKey(e,"<Esc>","user")})))}))}},compositionstart:function(e,t){this.useNextTextInput=true;CodeMirror.signal(this.cm,"inputEvent",e)},compositionupdate:function(e,t){CodeMirror.signal(this.cm,"inputEvent",e)},compositionend:function(e,t){CodeMirror.signal(this.cm,"inputEvent",e)},keypress:function(e,t){CodeMirror.signal(this.cm,"inputEvent",e);this.lastKeydown=="Dead"&&this.handleKey(e,t)},keydown:function(e,t){CodeMirror.signal(this.cm,"inputEvent",e);this.lastKeydown=e.key;if(this.lastKeydown=="Unidentified"||this.lastKeydown=="Process"||this.lastKeydown=="Dead")this.useNextTextInput=true;else{this.useNextTextInput=false;this.handleKey(e,t)}}},provide:()=>[d.inputHandler.of(((e,t,r,n)=>{var o,i;var a=getCM(e);if(!a)return false;var s=(o=a.state)===null||o===void 0?void 0:o.vim;var l=a.state.vimPlugin;if(s&&!s.insertMode&&!((i=a.curOp)===null||i===void 0?void 0:i.isVimOp)){if(n==="\0\0")return true;CodeMirror.signal(a,"inputEvent",{type:"text",text:n,from:t,to:r});if(n.length==1&&l.useNextTextInput){if(s.expectLiteralNext&&e.composing){l.compositionText=n;return false}if(l.compositionText){var c=l.compositionText;l.compositionText="";var u=e.state.selection.main.head;var h=e.state.sliceDoc(u-c.length,u);if(c===h){var f=a.getCursor();a.replaceRange("",a.posFromIndex(u-c.length),f)}}l.handleKey({key:n,preventDefault:()=>{},stopPropagation:()=>{}});forceEndComposition(e);return true}}return false}))],decorations:e=>e.decorations});function forceEndComposition(e){var t=e.scrollDOM.parentElement;if(t)if(F){e.contentDOM.textContent="\0\0";e.contentDOM.dispatchEvent(new CustomEvent("compositionend"))}else{var r=e.scrollDOM.nextSibling;var n=window.getSelection();var o=n&&{anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset};e.scrollDOM.remove();t.insertBefore(e.scrollDOM,r);try{if(o&&n){n.setPosition(o.anchorNode,o.anchorOffset);o.focusNode&&n.extend(o.focusNode,o.focusOffset)}}catch(e){console.error(e)}e.focus();e.contentDOM.dispatchEvent(new CustomEvent("compositionend"))}}const _=m.mark({class:"cm-searchMatch"});const j=o.define();const U=i.define({create:()=>false,update(e,t){for(let r of t.effects)r.is(j)&&(e=r.value);return e},provide:e=>g.from(e,(e=>e?createVimPanel:null))});function createVimPanel(e){let t=document.createElement("div");t.className="cm-vim-panel";let r=e.cm;r.state.dialog&&t.appendChild(r.state.dialog);return{top:false,dom:t}}function statusPanel(e){let t=document.createElement("div");t.className="cm-vim-panel";let r=e.cm;r.state.statusbar=t;r.state.vimPlugin.updateStatus();return{dom:t}}function vim(e={}){return[W,H,P,e.status?g.of(statusPanel):U]}function getCM(e){return e.cm||null}export{CodeMirror,D as Vim,getCM,vim};

